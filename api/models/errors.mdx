---
title: 'Tratamento de Erros'
description: 'Guia completo para tratamento de erros e códigos de status da API'
---

# Tratamento de Erros

Esta página fornece um guia completo para entender e tratar todos os tipos de erros retornados pela API do Manager SaaS. O tratamento adequado de erros é essencial para uma integração robusta e confiável.

## Visão Geral dos Erros

### **📋 Categorias de Erro**

| Categoria | HTTP Status | Descrição |
|-----------|-------------|-----------|
| **Validação** | 400 | Dados de entrada inválidos |
| **Autenticação** | 401 | Credenciais inválidas ou expiradas |
| **Autorização** | 403 | Permissões insuficientes |
| **Recurso** | 404 | Endpoint ou documento não encontrado |
| **Rate Limiting** | 429 | Limite de requisições excedido |
| **Servidor** | 500+ | Erros internos do sistema |

### **🔍 Formato Padrão de Erro**

```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "Descrição legível do erro",
    "details": [
      {
        "field": "campo_especifico",
        "message": "Mensagem específica do campo",
        "value": "valor_informado",
        "rule": "regra_violada"
      }
    ],
    "request_id": "req_1234567890abcdef",
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

## Erros de Validação (400)

### **❌ Erros de Validação de Dados**

```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Dados do documento inválidos",
    "details": [
      {
        "field": "emitente.cnpj",
        "message": "CNPJ deve ter 14 dígitos numéricos",
        "value": "123456789",
        "rule": "length"
      },
      {
        "field": "destinatario.email",
        "message": "Email deve ser válido",
        "value": "email_invalido",
        "rule": "email"
      },
      {
        "field": "valores.total",
        "message": "Valor total deve ser maior que zero",
        "value": 0,
        "rule": "min"
      }
    ],
    "request_id": "req_1234567890abcdef",
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

### **📋 Códigos de Erro de Validação**

| Código | Descrição | Solução |
|--------|-----------|---------|
| `VALIDATION_ERROR` | Erro geral de validação | Verificar todos os campos |
| `REQUIRED_FIELD` | Campo obrigatório não informado | Preencher campo obrigatório |
| `INVALID_FORMAT` | Formato do campo inválido | Verificar formato esperado |
| `INVALID_VALUE` | Valor do campo inválido | Verificar valor permitido |
| `FIELD_TOO_LONG` | Campo excede tamanho máximo | Reduzir tamanho do campo |
| `FIELD_TOO_SHORT` | Campo abaixo do tamanho mínimo | Aumentar tamanho do campo |

### **🔍 Validações Comuns**

#### **CNPJ/CPF**
```json
{
  "field": "emitente.cnpj",
  "message": "CNPJ deve ter 14 dígitos numéricos",
  "rule": "cnpj_format"
}
```

#### **Email**
```json
{
  "field": "destinatario.email",
  "message": "Email deve ser válido",
  "rule": "email_format"
}
```

#### **Data**
```json
{
  "field": "data_emissao",
  "message": "Data de emissão não pode ser futura",
  "rule": "date_not_future"
}
```

#### **Valores**
```json
{
  "field": "valores.total",
  "message": "Valor total deve ser maior que zero",
  "rule": "positive_number"
}
```

## Erros de Autenticação (401)

### **❌ Token Inválido ou Expirado**

```json
{
  "success": false,
  "error": {
    "code": "AUTHENTICATION_ERROR",
    "message": "Token de autenticação inválido",
    "details": [
      {
        "field": "authorization",
        "message": "Token expirado",
        "expired_at": "2024-01-01T11:00:00Z",
        "rule": "token_valid"
      }
    ],
    "request_id": "req_1234567890abcdef",
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

### **❌ Credenciais Basic Auth Inválidas**

```json
{
  "success": false,
  "error": {
    "code": "AUTHENTICATION_ERROR",
    "message": "Credenciais de autenticação inválidas",
    "details": [
      {
        "field": "authorization",
        "message": "Usuário ou senha incorretos",
        "rule": "valid_credentials"
      }
    ],
    "request_id": "req_1234567890abcdef",
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

### **📋 Códigos de Erro de Autenticação**

| Código | Descrição | Solução |
|--------|-----------|---------|
| `AUTHENTICATION_ERROR` | Erro geral de autenticação | Verificar credenciais |
| `TOKEN_EXPIRED` | Token expirado | Renovar token |
| `TOKEN_INVALID` | Token inválido | Verificar formato |
| `INVALID_CREDENTIALS` | Credenciais incorretas | Verificar usuário/senha |
| `MISSING_TOKEN` | Token não informado | Incluir header Authorization |

### **🔑 Soluções para Erros de Autenticação**

#### **1. Renovar Token**
```bash
curl -X POST "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/auth/token" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "seu_usuario",
    "password": "sua_senha"
  }'
```

#### **2. Verificar Formato do Header**
```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

#### **3. Verificar Credenciais Basic Auth**
```http
Authorization: Basic YWRtaW46MTIzbXVkYXI=
```

## Erros de Autorização (403)

### **❌ Permissões Insuficientes**

```json
{
  "success": false,
  "error": {
    "code": "AUTHORIZATION_ERROR",
    "message": "Acesso negado para esta operação",
    "details": [
      {
        "field": "permission",
        "message": "Usuário não tem permissão para emitir CT-e OS",
        "required_permission": "cte.emit",
        "user_permissions": ["cte.read", "cte.download"],
        "rule": "has_permission"
      }
    ],
    "request_id": "req_1234567890abcdef",
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

### **❌ Limite de Uso Excedido**

```json
{
  "success": false,
  "error": {
    "code": "AUTHORIZATION_ERROR",
    "message": "Limite de uso excedido para este plano",
    "details": [
      {
        "field": "plan_limit",
        "message": "Plano atual permite apenas 1000 emissões por mês",
        "current_usage": 1000,
        "limit": 1000,
        "rule": "within_plan_limits"
      }
    ],
    "request_id": "req_1234567890abcdef",
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

### **📋 Códigos de Erro de Autorização**

| Código | Descrição | Solução |
|--------|-----------|---------|
| `AUTHORIZATION_ERROR` | Erro geral de autorização | Verificar permissões |
| `INSUFFICIENT_PERMISSIONS` | Permissões insuficientes | Solicitar permissões |
| `PLAN_LIMIT_EXCEEDED` | Limite do plano excedido | Atualizar plano |
| `ACCOUNT_SUSPENDED` | Conta suspensa | Contatar suporte |
| `IP_NOT_ALLOWED` | IP não permitido | Verificar IP |

## Erros de Recurso (404)

### **❌ Endpoint Não Encontrado**

```json
{
  "success": false,
  "error": {
    "code": "NOT_FOUND_ERROR",
    "message": "Endpoint não encontrado",
    "details": [
      {
        "field": "endpoint",
        "message": "Endpoint /cteos/invalid não existe",
        "available_endpoints": ["/cteos/emite", "/cteos/consulta", "/cteos/envia"],
        "rule": "valid_endpoint"
      }
    ],
    "request_id": "req_1234567890abcdef",
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

### **❌ Documento Não Encontrado**

```json
{
  "success": false,
  "error": {
    "code": "CTE_NOT_FOUND",
    "message": "CT-e OS não encontrado",
    "details": [
      {
        "field": "cte_id",
        "message": "CT-e OS com ID cte_123456789 não existe",
        "searched_id": "cte_123456789",
        "rule": "document_exists"
      }
    ],
    "request_id": "req_1234567890abcdef",
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

### **📋 Códigos de Erro de Recurso**

| Código | Descrição | Solução |
|--------|-----------|---------|
| `NOT_FOUND_ERROR` | Recurso não encontrado | Verificar URL/ID |
| `CTE_NOT_FOUND` | CT-e OS não encontrado | Verificar ID do documento |
| `FILE_NOT_FOUND` | Arquivo não encontrado | Verificar disponibilidade |
| `USER_NOT_FOUND` | Usuário não encontrado | Verificar ID do usuário |
| `GROUP_NOT_FOUND` | Grupo não encontrado | Verificar nome do grupo |

## Erros de Rate Limiting (429)

### **❌ Limite de Requisições Excedido**

```json
{
  "success": false,
  "error": {
    "code": "RATE_LIMIT_EXCEEDED",
    "message": "Limite de requisições excedido",
    "details": [
      {
        "field": "rate_limit",
        "message": "Máximo de 100 requisições por minuto",
        "limit": 100,
        "reset_at": "2024-01-01T12:01:00Z",
        "rule": "within_rate_limit"
      }
    ],
    "request_id": "req_1234567890abcdef",
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

### **📋 Headers de Rate Limiting**

```http
HTTP/1.1 429 Too Many Requests
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 0
X-RateLimit-Reset: 1640995200
Retry-After: 60
```

### **📋 Códigos de Erro de Rate Limiting**

| Código | Descrição | Solução |
|--------|-----------|---------|
| `RATE_LIMIT_EXCEEDED` | Rate limit excedido | Aguardar e tentar novamente |
| `TOO_MANY_REQUESTS` | Muitas requisições | Implementar backoff exponencial |
| `QUOTA_EXCEEDED` | Cota excedida | Aguardar reset da cota |

### **🔄 Estratégias de Retry**

#### **1. Backoff Exponencial**
```javascript
const retryWithBackoff = async (fn, maxRetries = 3) => {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      if (error.code === 'RATE_LIMIT_EXCEEDED' && i < maxRetries - 1) {
        const delay = Math.pow(2, i) * 1000; // 1s, 2s, 4s
        await new Promise(resolve => setTimeout(resolve, delay));
        continue;
      }
      throw error;
    }
  }
};
```

#### **2. Retry com Delay Fixo**
```javascript
const retryWithDelay = async (fn, delay = 1000, maxRetries = 3) => {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (error) {
      if (error.code === 'RATE_LIMIT_EXCEEDED' && i < maxRetries - 1) {
        await new Promise(resolve => setTimeout(resolve, delay));
        continue;
      }
      throw error;
    }
  }
};
```

## Erros de Servidor (500+)

### **❌ Erro Interno do Servidor**

```json
{
  "success": false,
  "error": {
    "code": "INTERNAL_ERROR",
    "message": "Erro interno do servidor",
    "details": [
      {
        "field": "system",
        "message": "Falha na comunicação com SEFAZ",
        "component": "sefaz_gateway",
        "rule": "system_available"
      }
    ],
    "request_id": "req_1234567890abcdef",
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

### **❌ Serviço Indisponível**

```json
{
  "success": false,
  "error": {
    "code": "SERVICE_UNAVAILABLE",
    "message": "Serviço temporariamente indisponível",
    "details": [
      {
        "field": "maintenance",
        "message": "Manutenção programada em andamento",
        "estimated_completion": "2024-01-01T14:00:00Z",
        "rule": "service_available"
      }
    ],
    "request_id": "req_1234567890abcdef",
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

### **📋 Códigos de Erro de Servidor**

| Código | Descrição | Solução |
|--------|-----------|---------|
| `INTERNAL_ERROR` | Erro interno | Aguardar e tentar novamente |
| `SERVICE_UNAVAILABLE` | Serviço indisponível | Verificar status da API |
| `BAD_GATEWAY` | Gateway inválido | Aguardar e tentar novamente |
| `GATEWAY_TIMEOUT` | Timeout do gateway | Verificar conectividade |

## Erros Específicos do CT-e OS

### **❌ CT-e OS Já Existe**

```json
{
  "success": false,
  "error": {
    "code": "CTE_ALREADY_EXISTS",
    "message": "CT-e OS já existe com esta numeração",
    "details": [
      {
        "field": "numero",
        "message": "CT-e OS com número 000000001 já existe",
        "existing_cte_id": "cte_123456789",
        "rule": "unique_number"
      }
    ],
    "request_id": "req_1234567890abcdef",
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

### **❌ CT-e OS Não Pode Ser Cancelado**

```json
{
  "success": false,
  "error": {
    "code": "CTE_CANNOT_BE_CANCELLED",
    "message": "CT-e OS não pode ser cancelado",
    "details": [
      {
        "field": "status",
        "message": "Apenas CT-e OS autorizados podem ser cancelados",
        "current_status": "REJEITADO",
        "allowed_statuses": ["AUTORIZADO"],
        "rule": "cancellable_status"
      }
    ],
    "request_id": "req_1234567890abcdef",
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

### **❌ CT-e OS Não Pode Ser Descartado**

```json
{
  "success": false,
  "error": {
    "code": "CTE_CANNOT_BE_DISCARDED",
    "message": "CT-e OS não pode ser descartado",
    "details": [
      {
        "field": "status",
        "message": "Apenas CT-e OS rejeitados, registrados ou inutilizados podem ser descartados",
        "current_status": "AUTORIZADO",
        "allowed_statuses": ["REJEITADO", "REGISTRADO", "INUTILIZADO"],
        "rule": "discardable_status"
      }
    ],
    "request_id": "req_1234567890abcdef",
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

### **❌ Formato TX2 Inválido**

```json
{
  "success": false,
  "error": {
    "code": "INVALID_TX2_FORMAT",
    "message": "Formato TX2 inválido",
    "details": [
      {
        "field": "formato",
        "message": "Campo 'formato' deve ser 'tx2'",
        "value": "txt",
        "rule": "tx2_format"
      },
      {
        "field": "versao",
        "message": "Versão deve ser '3.00'",
        "value": "5.00",
        "rule": "valid_version"
      }
    ],
    "request_id": "req_1234567890abcdef",
    "timestamp": "2024-01-01T12:00:00Z"
  }
}
```

## Tratamento de Erros por Linguagem

### **💻 JavaScript/Node.js**

```javascript
class ManagerSaasError extends Error {
  constructor(errorData) {
    super(errorData.message);
    this.name = 'ManagerSaasError';
    this.code = errorData.code;
    this.details = errorData.details;
    this.requestId = errorData.request_id;
    this.timestamp = errorData.timestamp;
  }
}

const handleApiError = (response) => {
  if (!response.ok) {
    return response.json().then(errorData => {
      throw new ManagerSaasError(errorData.error);
    });
  }
  return response.json();
};

const processApiResponse = async (response) => {
  try {
    const resultado = await handleApiError(response);
    
    if (resultado.success) {
      return resultado.data;
    } else {
      throw new ManagerSaasError(resultado.error);
    }
  } catch (error) {
    if (error instanceof ManagerSaasError) {
      console.error(`Erro da API: ${error.message}`);
      console.error(`Código: ${error.code}`);
      console.error(`Request ID: ${error.requestId}`);
      
      // Tratamento específico por código
      switch (error.code) {
        case 'AUTHENTICATION_ERROR':
          // Renovar token
          break;
        case 'RATE_LIMIT_EXCEEDED':
          // Aguardar e tentar novamente
          break;
        case 'VALIDATION_ERROR':
          // Mostrar erros de validação
          error.details.forEach(detail => {
            console.error(`Campo ${detail.field}: ${detail.message}`);
          });
          break;
      }
    }
    throw error;
  }
};
```

### **🐍 Python**

```python
class ManagerSaasError(Exception):
    def __init__(self, error_data):
        self.message = error_data['message']
        self.code = error_data['code']
        self.details = error_data.get('details', [])
        self.request_id = error_data.get('request_id')
        self.timestamp = error_data.get('timestamp')
        super().__init__(self.message)

def handle_api_error(response):
    if not response.ok:
        error_data = response.json()
        raise ManagerSaasError(error_data['error'])
    return response.json()

def process_api_response(response):
    try:
        resultado = handle_api_error(response)
        
        if resultado['success']:
            return resultado['data']
        else:
            raise ManagerSaasError(resultado['error'])
            
    except ManagerSaasError as error:
        print(f"Erro da API: {error.message}")
        print(f"Código: {error.code}")
        print(f"Request ID: {error.request_id}")
        
        # Tratamento específico por código
        if error.code == 'AUTHENTICATION_ERROR':
            # Renovar token
            pass
        elif error.code == 'RATE_LIMIT_EXCEEDED':
            # Aguardar e tentar novamente
            pass
        elif error.code == 'VALIDATION_ERROR':
            # Mostrar erros de validação
            for detail in error.details:
                print(f"Campo {detail['field']}: {detail['message']}")
        
        raise error
```

### **🐘 PHP**

```php
class ManagerSaasError extends Exception {
    public $code;
    public $details;
    public $requestId;
    public $timestamp;
    
    public function __construct($errorData) {
        $this->message = $errorData['message'];
        $this->code = $errorData['code'];
        $this->details = $errorData['details'] ?? [];
        $this->requestId = $errorData['request_id'] ?? null;
        $this->timestamp = $errorData['timestamp'] ?? null;
        
        parent::__construct($this->message);
    }
}

function handleApiError($response) {
    $errorData = json_decode($response, true);
    throw new ManagerSaasError($errorData['error']);
}

function processApiResponse($response) {
    try {
        $resultado = json_decode($response, true);
        
        if ($resultado['success']) {
            return $resultado['data'];
        } else {
            throw new ManagerSaasError($resultado['error']);
        }
        
    } catch (ManagerSaasError $error) {
        echo "Erro da API: " . $error->getMessage() . "\n";
        echo "Código: " . $error->code . "\n";
        echo "Request ID: " . $error->requestId . "\n";
        
        // Tratamento específico por código
        switch ($error->code) {
            case 'AUTHENTICATION_ERROR':
                // Renovar token
                break;
            case 'RATE_LIMIT_EXCEEDED':
                // Aguardar e tentar novamente
                break;
            case 'VALIDATION_ERROR':
                // Mostrar erros de validação
                foreach ($error->details as $detail) {
                    echo "Campo {$detail['field']}: {$detail['message']}\n";
                }
                break;
        }
        
        throw $error;
    }
}
```

## Estratégias de Recuperação

### **🔄 Retry Automático**

```javascript
const retryOperation = async (operation, maxRetries = 3, baseDelay = 1000) => {
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      return await operation();
    } catch (error) {
      if (attempt === maxRetries) {
        throw error;
      }
      
      // Retry apenas para erros específicos
      if (['RATE_LIMIT_EXCEEDED', 'INTERNAL_ERROR', 'SERVICE_UNAVAILABLE'].includes(error.code)) {
        const delay = baseDelay * Math.pow(2, attempt - 1); // Backoff exponencial
        console.log(`Tentativa ${attempt} falhou. Tentando novamente em ${delay}ms...`);
        await new Promise(resolve => setTimeout(resolve, delay));
        continue;
      }
      
      throw error;
    }
  }
};
```

### **📊 Monitoramento de Erros**

```javascript
const errorTracker = {
  errors: [],
  
  track(error) {
    this.errors.push({
      timestamp: new Date(),
      code: error.code,
      message: error.message,
      requestId: error.requestId,
      endpoint: error.endpoint
    });
    
    // Enviar para serviço de monitoramento
    this.sendToMonitoring(error);
  },
  
  sendToMonitoring(error) {
    // Implementar envio para serviço de monitoramento
    console.log('Erro enviado para monitoramento:', error);
  },
  
  getErrorStats() {
    const stats = {};
    this.errors.forEach(error => {
      stats[error.code] = (stats[error.code] || 0) + 1;
    });
    return stats;
  }
};
```

## Logs e Debugging

### **📝 Logs de Erro**

```javascript
const logger = {
  error(error, context = {}) {
    const logEntry = {
      level: 'ERROR',
      timestamp: new Date().toISOString(),
      code: error.code,
      message: error.message,
      requestId: error.requestId,
      context,
      stack: error.stack
    };
    
    console.error('API Error:', logEntry);
    
    // Enviar para serviço de logs
    this.sendToLogService(logEntry);
  },
  
  sendToLogService(logEntry) {
    // Implementar envio para serviço de logs
  }
};
```

### **🔍 Debug de Requisições**

```javascript
const debugRequest = (request, response) => {
  console.log('=== DEBUG REQUEST ===');
  console.log('URL:', request.url);
  console.log('Method:', request.method);
  console.log('Headers:', request.headers);
  console.log('Body:', request.body);
  
  console.log('=== DEBUG RESPONSE ===');
  console.log('Status:', response.status);
  console.log('Headers:', response.headers);
  console.log('Body:', response.body);
};
```

## Próximos Passos

<CardGroup cols={2}>
  <Card
    title="Visão Geral da API"
    href="/api/overview"
    icon="code"
  >
    Visão geral da API
  </Card>
  <Card
    title="Modelos de Resposta"
    href="/api/models/response"
    icon="database"
  >
    Estruturas de resposta
  </Card>
  <Card
    title="Endpoints"
    href="/api/endpoints/emission"
    icon="play"
  >
    Todos os endpoints
  </Card>
  <Card
    title="Suporte"
    href="mailto:suporte@managersaas.com"
    icon="message-circle"
  >
    Entre em contato
  </Card>
</CardGroup>

---

⚠️ **Tratamento Robusto**: Implemente tratamento de erros adequado para garantir uma integração confiável com a API do Manager SaaS. Para dúvidas sobre códigos específicos, consulte nossa equipe de suporte. 