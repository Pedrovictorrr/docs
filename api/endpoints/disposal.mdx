---
title: 'Descarte de CT-e OS'
description: 'Descarta CT-e OS rejeitados ou registrados para reutilização da numeração'
---

# Descarte de CT-e OS

A rota de descarte permite invalidar um CT-e OS que foi rejeitado pela SEFAZ ou registrado, liberando a numeração para ser reutilizada em uma nova emissão corrigida.

## Quando Usar o Descarte

### **Situações que Permitem Descarte**

| Situação | Descrição | Permite Descarte |
|----------|-----------|------------------|
| **REJEITADA** | CT-e OS rejeitado pela SEFAZ | ✅ **Sim** |
| **REGISTRADA** | CT-e OS registrado mas não autorizado | ✅ **Sim** |
| **INUTILIZADA** | CT-e OS inutilizado | ✅ **Sim** |
| **IMPORTADA (Não autorizada)** | CT-e OS importado sem autorização | ✅ **Sim** |

### **Situações que NÃO Permitem Descarte**

| Situação | Descrição | Permite Descarte |
|----------|-----------|------------------|
| **AUTORIZADA** | CT-e OS autorizado pela SEFAZ | ❌ **Não** |
| **CANCELADA** | CT-e OS cancelado | ❌ **Não** |
| **DENEGADA** | CT-e OS denegado pela SEFAZ | ❌ **Não** |

## Endpoint de Descarte

```http
POST https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/descarta
```

## Autenticação

### **Headers Obrigatórios**

```http
Content-Type: application/x-www-form-urlencoded
Authorization: Basic YWRtaW46MTIzbXVkYXI=
```

<Note>
🔐 **Importante**: As credenciais de autenticação são as mesmas utilizadas para login como administrador no grupo do SaaS.
</Note>

## Parâmetros da Requisição

### **Parâmetros Obrigatórios**

| Parâmetro | Tipo | Descrição | Exemplo |
|-----------|------|-----------|---------|
| `Grupo` | string | Nome do grupo configurado no SaaS | `GRUPO_EMPRESA` |
| `CNPJ` | string | CNPJ vinculado ao grupo (apenas números) | `12345678000199` |
| `ChaveNota` | string | Chave do CT-e OS (44 dígitos) | `41150408187168000160576660000006671000000012` |
| `NumeroLote` | string | Número do lote do CT-e OS | `LOTE001` |

### **Formato da Chave do CT-e OS**

A chave do CT-e OS é composta por 44 dígitos com a seguinte estrutura:

```
41 15 04 08 187 168 000 123 67 07 300 000 000 511 000 002 70
│  │  │  │  │   │   │   │   │  │  │   │   │   │   │   │   │
│  │  │  │  │   │   │   │   │  │  │   │   │   │   │   │   └─ Número sequencial
│  │  │  │  │   │   │   │   │  │  │   │   │   │   │   └───── Série
│  │  │  │  │   │   │   │   │  │  │   │   │   │   └──────── Código do município
│  │  │  │  │   │   │   │   │  │  │   │   │   └──────────── Ano/Mês de emissão
│  │  │  │  │   │   │   │   │  │  │   │   └──────────────── Código do CT-e
│  │  │  │  │   │   │   │   │  │  │   └──────────────────── Código da UF
│  │  │  │  │   │   │   │   │  │  └──────────────────────── Modelo do documento
│  │  │  │  │   │   │   │   │  └──────────────────────────── Código da UF
│  │  │  │  │   │   │   │   └──────────────────────────────── Código do município
│  │  │  │  │   │   │   └──────────────────────────────────── Ano/Mês de emissão
│  │  │  │  │   │   └──────────────────────────────────────── Código do CT-e
│  │  │  │  │   └──────────────────────────────────────────── Código da UF
│  │  │  │  └──────────────────────────────────────────────── Código do município
│  │  │  └──────────────────────────────────────────────────── Ano/Mês de emissão
│  │  └────────────────────────────────────────────────────── Código do CT-e
│  └────────────────────────────────────────────────────────── Código da UF
└────────────────────────────────────────────────────────────── Código do município
```

## Exemplos de Requisição

### **1. Descarte de CT-e OS Rejeitado**

```bash
curl -X POST "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/descarta" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -H "Authorization: Basic YWRtaW46MTIzbXVkYXI=" \
  -d "Grupo=GRUPO_EMPRESA&CNPJ=12345678000199&ChaveNota=41150408187168000160576660000006671000000012&NumeroLote=LOTE001"
```

### **2. Descarte de CT-e OS Registrado**

```bash
curl -X POST "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/descarta" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -H "Authorization: Basic YWRtaW46MTIzbXVkYXI=" \
  -d "Grupo=GRUPO_EMPRESA&CNPJ=12345678000199&ChaveNota=41150408187168000160576660000006671000000013&NumeroLote=LOTE002"
```

### **3. Descarte de CT-e OS Inutilizado**

```bash
curl -X POST "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/descarta" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -H "Authorization: Basic YWRtaW46MTIzbXVkYXI=" \
  -d "Grupo=GRUPO_EMPRESA&CNPJ=12345678000199&ChaveNota=41150408187168000160576660000006671000000014&NumeroLote=LOTE003"
```

## Respostas da API

### **Resposta de Sucesso**

```
OK, Operação realizada com sucesso
```

**Status HTTP**: `200 OK`

### **Resposta de Erro**

```
EXCEPTION,EspdCheckParamsException,Somente CTe-OS REJEITADA\delimiter INUTILIZADA\delimiter REGISTRADA ou IMPORTADA(Não autorizada) pode ser descartada.
```

**Status HTTP**: `400 Bad Request`

### **Outros Erros Possíveis**

| Erro | Descrição | Solução |
|------|-----------|---------|
| `EXCEPTION,EspdCheckParamsException,Chave inválida` | Chave do CT-e OS incorreta | Verificar formato da chave (44 dígitos) |
| `EXCEPTION,EspdCheckParamsException,CT-e OS não encontrado` | CT-e OS inexistente | Verificar se a chave está correta |
| `EXCEPTION,EspdCheckParamsException,CNPJ inválido` | CNPJ incorreto | Verificar formato e validade do CNPJ |
| `EXCEPTION,EspdCheckParamsException,Grupo não encontrado` | Grupo inexistente | Verificar nome do grupo configurado |

## Implementação em Diferentes Linguagens

### **JavaScript/Node.js**

```javascript
class CTeOSDisposal {
  constructor(baseUrl, authToken) {
    this.baseUrl = baseUrl;
    this.authToken = authToken;
  }
  
  /**
   * Descarta um CT-e OS
   * @param {Object} params Parâmetros do descarte
   * @returns {Promise<Object>} Resultado da operação
   */
  async descartar(params) {
    const formData = new URLSearchParams();
    formData.append('Grupo', params.grupo);
    formData.append('CNPJ', params.cnpj);
    formData.append('ChaveNota', params.chaveNota);
    formData.append('NumeroLote', params.numeroLote);
    
    try {
      const response = await fetch(`${this.baseUrl}/cteos/descarta`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
          'Authorization': `Basic ${this.authToken}`
        },
        body: formData
      });
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const resultado = await response.text();
      
      if (resultado.includes('OK, Operação realizada com sucesso')) {
        return {
          success: true,
          message: resultado,
          status: 'DESCARTADO'
        };
      } else {
        return {
          success: false,
          error: resultado,
          status: 'ERRO'
        };
      }
      
    } catch (error) {
      console.error('Erro no descarte:', error);
      throw error;
    }
  }
  
  /**
   * Valida se o CT-e OS pode ser descartado
   * @param {string} chaveNota Chave do CT-e OS
   * @returns {Promise<boolean>} True se pode ser descartado
   */
  async podeSerDescartado(chaveNota) {
    // Primeiro consulta o status do CT-e OS
    try {
      const status = await this.consultarStatus(chaveNota);
      const situacoesPermitidas = ['REJEITADA', 'REGISTRADA', 'INUTILIZADA'];
      return situacoesPermitidas.includes(status.situacao);
    } catch (error) {
      console.error('Erro ao verificar status:', error);
      return false;
    }
  }
  
  /**
   * Consulta o status de um CT-e OS
   * @param {string} chaveNota Chave do CT-e OS
   * @returns {Promise<Object>} Status do CT-e OS
   */
  async consultarStatus(chaveNota) {
    // Implementar consulta de status
    // Esta é uma implementação de exemplo
    return { situacao: 'REJEITADA' };
  }
}

// Exemplo de uso
const disposal = new CTeOSDisposal(
  'https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb',
  'YWRtaW46MTIzbXVkYXI='
);

const realizarDescarte = async () => {
  try {
    // Verifica se pode ser descartado
    const podeDescarte = await disposal.podeSerDescartado('41150408187168000160576660000006671000000012');
    
    if (!podeDescarte) {
      console.log('CT-e OS não pode ser descartado');
      return;
    }
    
    // Realiza o descarte
    const resultado = await disposal.descartar({
      grupo: 'GRUPO_EMPRESA',
      cnpj: '12345678000199',
      chaveNota: '41150408187168000160576660000006671000000012',
      numeroLote: 'LOTE001'
    });
    
    if (resultado.success) {
      console.log('Descarte realizado com sucesso:', resultado.message);
    } else {
      console.error('Erro no descarte:', resultado.error);
    }
    
  } catch (error) {
    console.error('Erro:', error);
  }
};

realizarDescarte();
```

### **Python**

```python
import requests
from typing import Dict, Optional
from dataclasses import dataclass

@dataclass
class CTeOSDisposalResult:
    success: bool
    message: str
    status: str
    error: Optional[str] = None

class CTeOSDisposal:
    def __init__(self, base_url: str, auth_token: str):
        self.base_url = base_url
        self.auth_token = auth_token
        self.session = requests.Session()
        self.session.headers.update({
            'Authorization': f'Basic {auth_token}'
        })
    
    def descartar(self, params: Dict) -> CTeOSDisposalResult:
        """
        Descarta um CT-e OS
        
        Args:
            params: Dicionário com parâmetros do descarte
            
        Returns:
            CTeOSDisposalResult: Resultado da operação
        """
        url = f"{self.base_url}/cteos/descarta"
        
        data = {
            'Grupo': params['grupo'],
            'CNPJ': params['cnpj'],
            'ChaveNota': params['chave_nota'],
            'NumeroLote': params['numero_lote']
        }
        
        try:
            response = self.session.post(url, data=data)
            response.raise_for_status()
            
            resultado = response.text
            
            if 'OK, Operação realizada com sucesso' in resultado:
                return CTeOSDisposalResult(
                    success=True,
                    message=resultado,
                    status='DESCARTADO'
                )
            else:
                return CTeOSDisposalResult(
                    success=False,
                    message='',
                    status='ERRO',
                    error=resultado
                )
                
        except requests.exceptions.RequestException as e:
            return CTeOSDisposalResult(
                success=False,
                message='',
                status='ERRO',
                error=str(e)
            )
    
    def pode_ser_descartado(self, chave_nota: str) -> bool:
        """
        Verifica se o CT-e OS pode ser descartado
        
        Args:
            chave_nota: Chave do CT-e OS
            
        Returns:
            bool: True se pode ser descartado
        """
        try:
            status = self.consultar_status(chave_nota)
            situacoes_permitidas = ['REJEITADA', 'REGISTRADA', 'INUTILIZADA']
            return status.get('situacao') in situacoes_permitidas
        except Exception:
            return False
    
    def consultar_status(self, chave_nota: str) -> Dict:
        """
        Consulta o status de um CT-e OS
        
        Args:
            chave_nota: Chave do CT-e OS
            
        Returns:
            Dict: Status do CT-e OS
        """
        # Implementar consulta de status
        # Esta é uma implementação de exemplo
        return {'situacao': 'REJEITADA'}
    
    def validar_chave(self, chave_nota: str) -> bool:
        """
        Valida o formato da chave do CT-e OS
        
        Args:
            chave_nota: Chave do CT-e OS
            
        Returns:
            bool: True se a chave é válida
        """
        if not chave_nota or len(chave_nota) != 44:
            return False
        
        # Verifica se contém apenas dígitos
        return chave_nota.isdigit()

# Exemplo de uso
def main():
    disposal = CTeOSDisposal(
        'https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb',
        'YWRtaW46MTIzbXVkYXI='
    )
    
    # Valida a chave
    chave_nota = '41150408187168000160576660000006671000000012'
    if not disposal.validar_chave(chave_nota):
        print('Chave inválida')
        return
    
    # Verifica se pode ser descartado
    if not disposal.pode_ser_descartado(chave_nota):
        print('CT-e OS não pode ser descartado')
        return
    
    # Realiza o descarte
    resultado = disposal.descartar({
        'grupo': 'GRUPO_EMPRESA',
        'cnpj': '12345678000199',
        'chave_nota': chave_nota,
        'numero_lote': 'LOTE001'
    })
    
    if resultado.success:
        print(f'Descarte realizado com sucesso: {resultado.message}')
    else:
        print(f'Erro no descarte: {resultado.error}')

if __name__ == "__main__":
    main()
```

### **PHP**

```php
<?php

class CTeOSDisposal {
    private $baseUrl;
    private $authToken;
    private $httpClient;
    
    public function __construct($baseUrl, $authToken) {
        $this->baseUrl = $baseUrl;
        $this->authToken = $authToken;
        $this->httpClient = new HttpClient();
    }
    
    /**
     * Descarta um CT-e OS
     * 
     * @param array $params Parâmetros do descarte
     * @return array Resultado da operação
     * @throws Exception
     */
    public function descartar($params) {
        $url = $this->baseUrl . '/cteos/descarta';
        
        $headers = [
            'Content-Type: application/x-www-form-urlencoded',
            'Authorization: Basic ' . $this->authToken
        ];
        
        $postData = http_build_query([
            'Grupo' => $params['grupo'],
            'CNPJ' => $params['cnpj'],
            'ChaveNota' => $params['chaveNota'],
            'NumeroLote' => $params['numeroLote']
        ]);
        
        try {
            $response = $this->httpClient->post($url, $postData, $headers);
            
            if (strpos($response, 'OK, Operação realizada com sucesso') !== false) {
                return [
                    'success' => true,
                    'message' => $response,
                    'status' => 'DESCARTADO'
                ];
            } else {
                return [
                    'success' => false,
                    'message' => '',
                    'status' => 'ERRO',
                    'error' => $response
                ];
            }
            
        } catch (Exception $e) {
            return [
                'success' => false,
                'message' => '',
                'status' => 'ERRO',
                'error' => $e->getMessage()
            ];
        }
    }
    
    /**
     * Verifica se o CT-e OS pode ser descartado
     * 
     * @param string $chaveNota Chave do CT-e OS
     * @return bool True se pode ser descartado
     */
    public function podeSerDescartado($chaveNota) {
        try {
            $status = $this->consultarStatus($chaveNota);
            $situacoesPermitidas = ['REJEITADA', 'REGISTRADA', 'INUTILIZADA'];
            return in_array($status['situacao'], $situacoesPermitidas);
        } catch (Exception $e) {
            return false;
        }
    }
    
    /**
     * Consulta o status de um CT-e OS
     * 
     * @param string $chaveNota Chave do CT-e OS
     * @return array Status do CT-e OS
     */
    public function consultarStatus($chaveNota) {
        // Implementar consulta de status
        // Esta é uma implementação de exemplo
        return ['situacao' => 'REJEITADA'];
    }
    
    /**
     * Valida o formato da chave do CT-e OS
     * 
     * @param string $chaveNota Chave do CT-e OS
     * @return bool True se a chave é válida
     */
    public function validarChave($chaveNota) {
        if (empty($chaveNota) || strlen($chaveNota) !== 44) {
            return false;
        }
        
        // Verifica se contém apenas dígitos
        return ctype_digit($chaveNota);
    }
    
    /**
     * Realiza o descarte com validações
     * 
     * @param array $params Parâmetros do descarte
     * @return array Resultado da operação
     */
    public function descartarComValidacao($params) {
        // Valida a chave
        if (!$this->validarChave($params['chaveNota'])) {
            return [
                'success' => false,
                'message' => '',
                'status' => 'ERRO',
                'error' => 'Chave inválida'
            ];
        }
        
        // Verifica se pode ser descartado
        if (!$this->podeSerDescartado($params['chaveNota'])) {
            return [
                'success' => false,
                'message' => '',
                'status' => 'ERRO',
                'error' => 'CT-e OS não pode ser descartado'
            ];
        }
        
        // Realiza o descarte
        return $this->descartar($params);
    }
}

class HttpClient {
    public function post($url, $data, $headers = []) {
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
        curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_TIMEOUT, 60);
        
        $response = curl_exec($ch);
        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        $error = curl_error($ch);
        curl_close($ch);
        
        if ($error) {
            throw new Exception("Erro cURL: {$error}");
        }
        
        if ($httpCode !== 200) {
            throw new Exception("Erro HTTP: {$httpCode}");
        }
        
        return $response;
    }
}

// Exemplo de uso
try {
    $disposal = new CTeOSDisposal(
        'https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb',
        'YWRtaW46MTIzbXVkYXI='
    );
    
    // Valida a chave
    $chaveNota = '41150408187168000160576660000006671000000012';
    if (!$disposal->validarChave($chaveNota)) {
        echo "Chave inválida\n";
        exit;
    }
    
    // Verifica se pode ser descartado
    if (!$disposal->podeSerDescartado($chaveNota)) {
        echo "CT-e OS não pode ser descartado\n";
        exit;
    }
    
    // Realiza o descarte com validações
    $resultado = $disposal->descartarComValidacao([
        'grupo' => 'GRUPO_EMPRESA',
        'cnpj' => '12345678000199',
        'chaveNota' => $chaveNota,
        'numeroLote' => 'LOTE001'
    ]);
    
    if ($resultado['success']) {
        echo "Descarte realizado com sucesso: " . $resultado['message'] . "\n";
    } else {
        echo "Erro no descarte: " . $resultado['error'] . "\n";
    }
    
} catch (Exception $e) {
    echo "Erro: " . $e->getMessage() . "\n";
}
?>
```

## Fluxo de Descarte

### **1. Verificação de Elegibilidade**

```mermaid
flowchart TD
    A[Início] --> B[Consultar Status do CT-e OS]
    B --> C{Status Permitido?}
    C -->|Sim| D[Validar Parâmetros]
    C -->|Não| E[Erro: Não pode ser descartado]
    D --> F{Parâmetros Válidos?}
    F -->|Sim| G[Executar Descarte]
    F -->|Não| H[Erro: Parâmetros inválidos]
    G --> I{Descarte Realizado?}
    I -->|Sim| J[Sucesso: Numeração liberada]
    I -->|Não| K[Erro: Falha no descarte]
```

### **2. Processo de Descarte**

1. **Validação Inicial**
   - Verificar se o CT-e OS existe
   - Confirmar se o status permite descarte
   - Validar parâmetros da requisição

2. **Execução do Descarte**
   - Marcar CT-e OS como descartado
   - Liberar a numeração para reutilização
   - Registrar log da operação

3. **Confirmação**
   - Retornar mensagem de sucesso
   - Atualizar status no sistema

## Casos de Uso

### **1. Correção de CT-e OS Rejeitado**
- CT-e OS rejeitado pela SEFAZ
- Necessidade de corrigir dados
- Reutilização da mesma numeração

### **2. Cancelamento de CT-e OS Registrado**
- CT-e OS registrado mas não autorizado
- Mudança de decisão sobre emissão
- Liberação da numeração

### **3. Inutilização de CT-e OS**
- CT-e OS com problemas técnicos
- Necessidade de reiniciar numeração
- Limpeza do sistema

### **4. Importação de CT-e OS Não Autorizado**
- CT-e OS importado sem autorização
- Necessidade de revalidação
- Processo de autorização manual

## Tratamento de Erros

### **Erros Comuns e Soluções**

| Erro | Causa | Solução |
|------|-------|---------|
| **Chave inválida** | Formato incorreto da chave | Verificar se tem 44 dígitos numéricos |
| **CT-e OS não encontrado** | Chave inexistente | Confirmar se a chave está correta |
| **Status não permite descarte** | CT-e OS autorizado/cancelado | Verificar status atual do documento |
| **CNPJ inválido** | CNPJ incorreto | Verificar formato e validade do CNPJ |
| **Grupo não encontrado** | Grupo inexistente | Confirmar nome do grupo configurado |

### **Validações Recomendadas**

#### **Antes do Descarte**
- ✅ Verificar se o CT-e OS existe
- ✅ Confirmar se o status permite descarte
- ✅ Validar formato da chave (44 dígitos)
- ✅ Confirmar se o grupo e CNPJ estão corretos

#### **Após o Descarte**
- ✅ Confirmar mensagem de sucesso
- ✅ Verificar se a numeração foi liberada
- ✅ Consultar status atualizado do CT-e OS
- ✅ Testar emissão com a numeração liberada

## Limitações e Considerações

### **Limitações Técnicas**
- **Status único**: Apenas CT-e OS com status específicos podem ser descartados
- **Chave obrigatória**: A chave de 44 dígitos é obrigatória
- **Lote obrigatório**: Número do lote deve ser informado
- **Autenticação**: Requer credenciais de administrador

### **Considerações de Negócio**
- **Numeração sequencial**: Descarte libera a numeração para reutilização
- **Auditoria**: Todas as operações de descarte são registradas
- **Conformidade**: Descarte deve seguir regras da SEFAZ
- **Histórico**: Manter registro de CT-e OS descartados

### **Segurança**
- **Autenticação**: Sempre use credenciais válidas
- **Autorização**: Apenas administradores podem descartar
- **Logs**: Todas as operações são registradas
- **Validação**: Sempre valide parâmetros antes do descarte

## Próximos Passos

<CardGroup cols={2}>
  <Card
    title="Emissão de CT-e OS"
    href="/api/endpoints/emission"
    icon="rocket"
  >
    Emita novos documentos
  </Card>
  <Card
    title="Consulta Avançada"
    href="/api/endpoints/consultation"
    icon="search"
  >
    Consulte documentos existentes
  </Card>
  <Card
    title="Conversão TX2 para XML"
    href="/api/endpoints/conversion"
    icon="file-text"
  >
    Converta arquivos TX2
  </Card>
  <Card
    title="Suporte"
    href="mailto:suporte@managersaas.com"
    icon="message-circle"
  >
    Entre em contato conosco
  </Card>
</CardGroup>

---

🗑️ **Descarte Inteligente**: Libere numerações de CT-e OS rejeitados ou registrados para reutilização. Para dúvidas sobre o processo de descarte ou situações específicas, consulte nossa equipe de suporte. 