---
title: 'Autenticação por API Key'
description: 'Configuração de autenticação por API Key para emissão de CT-e'
---

# Autenticação por API Key

## Visão Geral

A API de CT-e utiliza autenticação baseada em **API Keys** para garantir a segurança e autenticidade das transações. Este documento explica como configurar e utilizar este método de autenticação.

## Autenticação por API Key

### O que é API Key?

A **API Key** é um token único que identifica sua conta e autoriza o acesso aos endpoints da API. É a forma mais simples de autenticação para integrações.

### Como obter seu Token de Autenticação

Para obter o token de autenticação, você precisa fazer uma requisição para o endpoint de autenticação:

**Endpoint:** `https://managersaas.tecnospeed.com.br:1337/api/v1/software-house/token`

**Método:** `POST`

**Headers:**
```http
Content-Type: application/json
```

**Body:**
```json
{
  "email": "seu_email@exemplo.com",
  "senha": "sua_senha",
  "gerar": 1,
  "api": 0
}
```

**Parâmetros do Body:**

| Parâmetro | Descrição | Valores |
|-----------|-----------|---------|
| `email` | E-mail do login da Software House | String |
| `senha` | Senha da Software House | String |
| `gerar` | Indica se o token deve ser gerado | `1` - Gerar novo token<br>`0` - Não gerar |
| `api` | Tipo de token a ser gerado | `1` - Token da API (sem expiração)<br>`0` - Token com data de expiração |

**Exemplo de requisição:**

<CodeGroup>

```bash
curl -X POST "https://managersaas.tecnospeed.com.br:1337/api/v1/software-house/token" \
  -H "Content-Type: application/json" \
  -d '{
    "email": "seu_email@exemplo.com",
    "senha": "sua_senha"
  }'
```

```php
<?php
// Usando Laravel HTTP Client
use Illuminate\Support\Facades\Http;

$response = Http::post('https://managersaas.tecnospeed.com.br:1337/api/v1/software-house/token', [
    'email' => 'seu_email@exemplo.com',
    'senha' => 'sua_senha',
    'gerar' => 1,
    'api' => 0
]);

$token = $response->json();
?>

```php
<?php
// Usando Guzzle HTTP Client
use GuzzleHttp\Client;

$client = new Client();
$response = $client->post('https://managersaas.tecnospeed.com.br:1337/api/v1/software-house/token', [
    'json' => [
        'email' => 'seu_email@exemplo.com',
        'senha' => 'sua_senha',
        'gerar' => 1,
        'api' => 0
    ]
]);

$token = json_decode($response->getBody(), true);
?>
```

```php
<?php
// Usando cURL nativo
$url = 'https://managersaas.tecnospeed.com.br:1337/api/v1/software-house/token';
$data = [
    'email' => 'seu_email@exemplo.com',
    'senha' => 'sua_senha',
    'gerar' => 1,
    'api' => 0
];

$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $url);
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

$response = curl_exec($ch);
curl_close($ch);

$token = json_decode($response, true);
?>
```

</CodeGroup>

**Resposta esperada:**

**Token com expiração (api = 0):**
```json
{
  "mensagem": "Token gerado com sucesso",
  "dados": {
    "token": "6zl7aiaxfdhen4s4i1514552593339",
    "tokenexpiracao": "2017-12-29T14:03:13.000Z"
  }
}
```

**Token da API (api = 1) - sem expiração:**
```json
{
  "mensagem": "Token API gerado com sucesso",
  "dados": {
    "token": "111m2znr0w9wb1568981163868"
  }
}
```

**⚠️ Importante:** 
- Tokens com expiração (`api = 0`) são válidos por **3 horas**
- Tokens da API (`api = 1`) não possuem data de expiração
- Para operações de CT-e, recomenda-se usar tokens com expiração para maior segurança

### Uso do Token de Autenticação

O token JWT obtido deve ser incluído no cabeçalho de todas as requisições subsequentes:

```http
Authorization: Bearer YOUR_JWT_TOKEN_HERE
```

**⚠️ Importante:** 
- Tokens com expiração são válidos por **3 horas**
- Tokens da API não possuem expiração
- Para operações de CT-e, recomenda-se usar tokens com expiração para maior segurança
- Você precisará renovar tokens expirados fazendo uma nova requisição de autenticação

**Exemplo em Laravel:**

<CodeGroup>

```php
<?php
// Usando Laravel HTTP Client
use Illuminate\Support\Facades\Http;

$response = Http::withHeaders([
    'Authorization' => 'Bearer ' . $jwtToken,
    'Content-Type' => 'application/json'
])->post('https://managersaas.tecnospeed.com.br:1337/api/v1/cte/emission', [
    'dados' => '...'
]);

$resultado = $response->json();
?>
```

```php
<?php
// Usando Guzzle HTTP Client
use GuzzleHttp\Client;

$client = new Client();
$response = $client->post('https://managersaas.tecnospeed.com.br:1337/api/v1/cte/emission', [
    'headers' => [
        'Authorization' => 'Bearer ' . $jwtToken,
        'Content-Type' => 'application/json'
    ],
    'json' => [
        'dados' => '...'
    ]
]);

$resultado = json_decode($response->getBody(), true);
?>
```

```php
<?php
// Usando cURL nativo
$headers = [
    'Authorization: Bearer ' . $jwtToken,
    'Content-Type: application/json'
];

$ch = curl_init();
curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
// ... resto da configuração
?>
```

</CodeGroup>

### Segurança do Token JWT

<CardGroup cols={2}>
  <Card
    title="Mantenha Seguro"
    icon="lock"
  >
    Nunca compartilhe seu token ou o inclua em código público
  </Card>
  <Card
    title="Validade Limitada"
    icon="clock"
  >
    Tokens com expiração são válidos por 3 horas
  </Card>
  <Card
    title="Renovação Automática"
    icon="refresh-cw"
  >
    Implemente renovação automática antes da expiração
  </Card>
  <Card
    title="Transmissão Segura"
    icon="shield"
  >
    Sempre use HTTPS para transmissão de credenciais
  </Card>
</CardGroup>

## Tratamento de Erros

### **Erros de Autenticação**

| Código | Descrição | Solução |
|--------|-----------|---------|
| `401` | Token inválido ou expirado | Faça nova requisição de autenticação |
| `403` | Acesso negado | Verifique as permissões da conta |
| `429` | Rate limit excedido | Aguarde ou use conta com maior limite |
| `400` | Credenciais inválidas | Verifique email, senha e parâmetros gerar/api |
| `500` | Erro interno do servidor | Tente novamente ou contate suporte |

## Exemplos Práticos

### **Configuração Completa**

```php
<?php
class CTEApi {
    private $email;
    private $senha;
    private $token;
    private $baseUrl = 'https://managersaas.tecnospeed.com.br:1337';
    
    public function __construct($email, $senha) {
        $this->email = $email;
        $this->senha = $senha;
    }
    
    private function authenticate() {
        $url = $this->baseUrl . '/api/v1/software-house/token';
        $data = [
            'email' => $this->email,
            'senha' => $this->senha,
            'gerar' => 1,
            'api' => 0
        ];
        
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data));
        curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        
        $response = curl_exec($ch);
        curl_close($ch);
        
        $result = json_decode($response, true);
        
        if (isset($result['dados']['token'])) {
            $this->token = $result['dados']['token'];
            return true;
        }
        
        return false;
    }
    
    public function emitirCTe($dados) {
        // Autentica se não tiver token
        if (!$this->token) {
            if (!$this->authenticate()) {
                throw new Exception('Falha na autenticação');
            }
        }
        
        $headers = [
            'Authorization: Bearer ' . $this->token,
            'Content-Type: application/json'
        ];
        
        $payload = [
            'dados_cte' => $dados
        ];
        
        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, $this->baseUrl . '/api/v1/cte/emission');
        curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
        curl_setopt($ch, CURLOPT_POST, true);
        curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($payload));
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        
        $response = curl_exec($ch);
        curl_close($ch);
        
        return json_decode($response, true);
    }
    
    public function renovarToken() {
        $this->token = null;
        return $this->authenticate();
    }
}

// Uso
$api = new CTEApi('seu_email@exemplo.com', 'sua_senha');

// Emitir CT-e
$resultado = $api->emitirCTe($dadosCTe);
?>
```

## Próximos Passos

1. **Prepare suas credenciais** (email e senha da Software House)
2. **Configure os parâmetros** de autenticação (gerar=1, api=0)
3. **Teste a autenticação** em ambiente sandbox
4. **Implemente a integração** com sua aplicação
5. **Configure renovação automática** de tokens (a cada 2.5 horas)

## Suporte

Para dúvidas sobre autenticação:

- **Email**: suporte@managersaas.com
- **Documentação**: [docs.managersaas.com](https://docs.managersaas.com)
- **Status**: [status.managersaas.com](https://status.managersaas.com) 