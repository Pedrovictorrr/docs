---
title: 'Consulta Avan√ßada'
description: 'Rota de consulta avan√ßada para CT-e OS com filtros personalizados'
---

# Consulta Avan√ßada - CT-e OS

A rota de consulta avan√ßada permite buscar CT-e OS com filtros personalizados, campos espec√≠ficos e ordena√ß√£o personalizada, oferecendo flexibilidade total para consultas no banco de dados.

## Endpoint de Consulta

```http
GET https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/consulta
```

## Autentica√ß√£o

### **Headers Obrigat√≥rios**

```http
Authorization: Basic YWRtaW46MTIzbXVkYXI=
Content-Type: application/json
```

<Note>
üîê **Importante**: As credenciais de autentica√ß√£o s√£o as mesmas utilizadas para login como administrador no grupo do SaaS.
</Note>

## Par√¢metros da Query

### **Par√¢metros Obrigat√≥rios**

| Par√¢metro | Tipo | Descri√ß√£o | Exemplo |
|-----------|------|-----------|---------|
| `Grupo` | string | Nome do grupo configurado no SaaS | `Grupo=GRUPO_EMPRESA` |
| `CNPJ` | string | CNPJ vinculado ao grupo (apenas n√∫meros) | `CNPJ=12345678000199` |
| `Campos` | string | Campos a retornar (separados por v√≠rgula) | `Campos=chave,situacao,numero` |

### **Par√¢metros Opcionais**

| Par√¢metro | Tipo | Descri√ß√£o | Exemplo |
|-----------|------|-----------|---------|
| `Filtro` | string | Filtro personalizado da consulta | `Filtro=situacao=AUTORIZADA` |
| `Limite` | number | Limite de registros (m√°x: 100) | `Limite=50` |
| `Ordem` | string | Ordena√ß√£o dos resultados | `Ordem=dtemissao DESC` |
| `Visao` | string | Tabela espec√≠fica para consulta | `Visao=TspdCTeOSVWConsulta` |

## Campos Dispon√≠veis para Consulta

### **Campos de Identifica√ß√£o**

| Campo | Descri√ß√£o | Tipo | Exemplo |
|-------|-----------|------|---------|
| `idintegracao` | N√∫mero do idintegra√ß√£o | number | `12345` |
| `handle` | Handle √∫nico do registro | string | `abc123def456` |
| `chave` | Chave do CT-e OS (44 d√≠gitos) | string | `41150408187168000160576660000006671000000012` |
| `numero` | N√∫mero sequencial do CT-e OS | number | `667` |
| `serie` | S√©rie do CT-e OS | string | `324` |
| `codct` | C√≥digo num√©rico da Chave de Acesso | string | `6671000000012` |

### **Campos de Status e Protocolo**

| Campo | Descri√ß√£o | Tipo | Exemplo |
|-------|-----------|------|---------|
| `situacao` | Situa√ß√£o atual do CT-e OS | string | `AUTORIZADA`, `CANCELADA`, `REJEITADA` |
| `nprotenvio` | Protocolo de envio (15 d√≠gitos) | string | `123456789012345` |
| `nprotcanc` | Protocolo de cancelamento (15 d√≠gitos) | string | `987654321098765` |
| `nprotinutil` | Protocolo de inutiliza√ß√£o (15 d√≠gitos) | string | `111111111111111` |
| `cstat` | C√≥digo de status da SEFAZ | number | `100` |
| `motivo` | Mensagem de autoriza√ß√£o/rejei√ß√£o | string | `Autorizado o uso da NF-e` |

### **Campos de Data e Hora**

| Campo | Descri√ß√£o | Tipo | Exemplo |
|-------|-----------|------|---------|
| `dtemissao` | Data e hora de emiss√£o | datetime | `15/01/2024 10:30:00` |
| `dtautorizacao` | Data e hora de autoriza√ß√£o | datetime | `15/01/2024 10:31:15` |
| `dtcancelamento` | Data e hora de cancelamento | datetime | `15/01/2024 11:00:00` |
| `dtcadastro` | Data de cadastro no sistema | datetime | `15/01/2024 09:00:00` |

### **Campos de Emissor e Grupo**

| Campo | Descri√ß√£o | Tipo | Exemplo |
|-------|-----------|------|---------|
| `cnpj` | CNPJ do Emitente | string | `12345678000199` |
| `idgrupo` | ID num√©rico do grupo | number | `1` |
| `nomegrupo` | Nome do grupo configurado | string | `GRUPO_EMPRESA` |
| `ambiente` | Ambiente de emiss√£o | number | `1` (Produ√ß√£o), `2` (Homologa√ß√£o) |

### **Campos de Participantes**

| Campo | Descri√ß√£o | Tipo | Exemplo |
|-------|-----------|------|---------|
| `doctomador` | CNPJ do Tomador do servi√ßo | string | `98765432000188` |
| `docremetente` | CNPJ do Remetente | string | `11111111000199` |
| `docexpedidor` | CNPJ do Expedidor | string | `22222222000199` |
| `docrecebedor` | CNPJ do Recebedor | string | `33333333000199` |
| `docdestinatario` | CNPJ do Destinat√°rio | string | `44444444000199` |
| `nomedestinatario` | Nome do Destinat√°rio | string | `CLIENTE EXEMPLO LTDA` |

### **Campos de Classifica√ß√£o**

| Campo | Descri√ß√£o | Tipo | Valores |
|-------|-----------|------|---------|
| `origem` | Origem dos registros | number | `1` (Emitidas √† Terceiros)<br>`2` (Recebidas de Terceiros)<br>`3` (Opera√ß√£o Interna)<br>`4` (Todas) |
| `tomador` | Papel do tomador | number | `0` (Remetente)<br>`1` (Expedidor)<br>`2` (Recebedor)<br>`3` (Destinat√°rio) |
| `modoentrada` | Modo de entrada | string | `Normal`, `EPEC`, `FSDA`, `SVSRS`, `SVCSP` |

### **Campos de Sistema e Controle**

| Campo | Descri√ß√£o | Tipo | Valores |
|-------|-----------|------|---------|
| `eventos` | Quantidade de eventos recebidos | number | `0`, `1`, `2`, etc. |
| `sincronizadopm` | Sincroniza√ß√£o com PrintManager | number | `0` (N√£o sincronizado)<br>`1` (Sincronizado) |
| `impresso` | Status de impress√£o | string | `Sim`, `N√£o` |
| `envemail` | Status do envio de e-mail | string | `Sim`, `N√£o` |
| `impressora` | Nome da impressora padr√£o | string | `IMPRESSORA_PADRAO` |

### **Campos de Contato e Comunica√ß√£o**

| Campo | Descri√ß√£o | Tipo | Exemplo |
|-------|-----------|------|---------|
| `email` | E-mail do Tomador | string | `cliente@email.com` |
| `emailtomador` | E-mail do Tomador (alternativo) | string | `tomador@email.com` |

### **Campos de Conte√∫do**

| Campo | Descri√ß√£o | Tipo | Exemplo |
|-------|-----------|------|---------|
| `xmlcteosautorizado` | XML completo autorizado | text | `<cteProc>...</cteProc>` |

## Exemplos de Filtros

### **Filtros Simples**

#### **Por Situa√ß√£o**
```
Filtro=situacao=AUTORIZADA
```

#### **Por CNPJ do Emissor**
```
Filtro=cnpj=12345678000199
```

#### **Por N√∫mero**
```
Filtro=numero=667
```

#### **Por S√©rie**
```
Filtro=serie=324
```

#### **Por Chave de Acesso**
```
Filtro=chave=41150408187168000160576660000006671000000012
```

### **Filtros por Data**

#### **Por Data de Emiss√£o**
```
Filtro=dtemissao>=01/01/2024
```

#### **Por Data de Autoriza√ß√£o**
```
Filtro=dtautorizacao>=01/01/2024
```

#### **Por Per√≠odo de Emiss√£o**
```
Filtro=dtemissao>=01/01/2024 and dtemissao<=31/01/2024
```

#### **Por Data de Cancelamento**
```
Filtro=dtcancelamento>=01/01/2024
```

### **Filtros M√∫ltiplos**

#### **CT-e OS Autorizados do M√™s**
```
Filtro=situacao=AUTORIZADA and dtemissao>=01/01/2024
```

#### **CT-e OS por CNPJ e Situa√ß√£o**
```
Filtro=cnpj=12345678000199 and situacao=AUTORIZADA
```

#### **CT-e OS por Tomador e Per√≠odo**
```
Filtro=doctomador=98765432000188 and dtemissao>=01/01/2024
```

#### **CT-e OS Cancelados com Motivo**
```
Filtro=situacao=CANCELADA and motivo like %erro%
```

### **Filtros Avan√ßados**

#### **Por Ambiente**
```
Filtro=ambiente=1
```

#### **Por Origem**
```
Filtro=origem=1
```

#### **Por Papel do Tomador**
```
Filtro=tomador=3
```

#### **Por Modo de Entrada**
```
Filtro=modoentrada=Normal
```

## Exemplos de Ordena√ß√£o

### **Ordena√ß√£o Simples**

#### **Por Data de Emiss√£o (Decrescente)**
```
Ordem=dtemissao DESC
```

#### **Por N√∫mero (Crescente)**
```
Ordem=numero ASC
```

#### **Por Situa√ß√£o (Alfab√©tica)**
```
Ordem=situacao ASC
```

### **Ordena√ß√£o M√∫ltipla**

#### **Por Situa√ß√£o e Data**
```
Ordem=situacao ASC, dtemissao DESC
```

#### **Por CNPJ e N√∫mero**
```
Ordem=cnpj ASC, numero DESC
```

#### **Por Data de Cadastro e Handle**
```
Ordem=dtcadastro DESC, handle ASC
```

## Exemplos de Consultas Completas

### **1. CT-e OS Autorizados do M√™s Atual**

```bash
curl -X GET "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/consulta?Grupo=GRUPO_EMPRESA&CNPJ=12345678000199&Filtro=situacao=AUTORIZADA and dtemissao>=01/01/2024&Campos=chave,situacao,numero,dtemissao,valor_total&Ordem=dtemissao DESC&Limite=100"
```

**Campos retornados**: chave, situa√ß√£o, n√∫mero, data de emiss√£o, valor total
**Filtro**: Apenas CT-e OS autorizados emitidos em janeiro de 2024
**Ordena√ß√£o**: Por data de emiss√£o (mais recentes primeiro)
**Limite**: 100 registros

### **2. CT-e OS por CNPJ do Tomador**

```bash
curl -X GET "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/consulta?Grupo=GRUPO_EMPRESA&CNPJ=12345678000199&Filtro=doctomador=98765432000188&Campos=chave,situacao,numero,dtemissao,doctomador,nomedestinatario&Ordem=dtemissao DESC&Limite=50"
```

**Campos retornados**: chave, situa√ß√£o, n√∫mero, data de emiss√£o, CNPJ do tomador, nome do destinat√°rio
**Filtro**: Apenas CT-e OS onde o tomador √© o CNPJ espec√≠fico
**Ordena√ß√£o**: Por data de emiss√£o (mais recentes primeiro)
**Limite**: 50 registros

### **3. CT-e OS Cancelados com Motivo**

```bash
curl -X GET "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/consulta?Grupo=GRUPO_EMPRESA&CNPJ=12345678000199&Filtro=situacao=CANCELADA&Campos=chave,situacao,numero,dtcancelamento,motivo,doctomador&Ordem=dtcancelamento DESC&Limite=100"
```

**Campos retornados**: chave, situa√ß√£o, n√∫mero, data de cancelamento, motivo, CNPJ do tomador
**Filtro**: Apenas CT-e OS cancelados
**Ordena√ß√£o**: Por data de cancelamento (mais recentes primeiro)
**Limite**: 100 registros

### **4. CT-e OS por S√©rie Espec√≠fica**

```bash
curl -X GET "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/consulta?Grupo=GRUPO_EMPRESA&CNPJ=12345678000199&Filtro=serie=324&Campos=chave,situacao,numero,serie,dtemissao,doctomador&Ordem=numero ASC&Limite=100"
```

**Campos retornados**: chave, situa√ß√£o, n√∫mero, s√©rie, data de emiss√£o, CNPJ do tomador
**Filtro**: Apenas CT-e OS da s√©rie 324
**Ordena√ß√£o**: Por n√∫mero (crescente)
**Limite**: 100 registros

### **5. CT-e OS por Per√≠odo e Ambiente**

```bash
curl -X GET "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/consulta?Grupo=GRUPO_EMPRESA&CNPJ=12345678000199&Filtro=dtemissao>=01/01/2024 and ambiente=1&Campos=chave,situacao,numero,dtemissao,ambiente,origem&Ordem=dtemissao DESC&Limite=100"
```

**Campos retornados**: chave, situa√ß√£o, n√∫mero, data de emiss√£o, ambiente, origem
**Filtro**: CT-e OS emitidos em 2024 no ambiente de produ√ß√£o
**Ordena√ß√£o**: Por data de emiss√£o (mais recentes primeiro)
**Limite**: 100 registros

## Tratamento de Respostas

### **Resposta de Sucesso**

A resposta √© retornada em formato CSV simples, com os campos separados por v√≠rgula e espa√ßo:

```
41150408187168000160576660000006671000000012, AUTORIZADA, 667, 15/01/2024 10:30:00
41150408187168000160576660000006672000000012, AUTORIZADA, 668, 15/01/2024 11:15:00
41150408187168000160576660000006673000000012, CANCELADA, 669, 15/01/2024 12:00:00
```

### **Resposta sem Registros**

```
Nenhum registro encontrado.
```

### **Tratamento de Erros**

#### **Erro de Autentica√ß√£o (401)**
```
Unauthorized: Credenciais inv√°lidas
```

#### **Erro de Par√¢metros (400)**
```
Bad Request: Par√¢metros obrigat√≥rios n√£o informados
```

#### **Erro de Limite (400)**
```
Bad Request: Limite m√°ximo excedido (m√°ximo: 100)
```

#### **Erro de Filtro (400)**
```
Bad Request: Filtro inv√°lido
```

#### **Erro de Servidor (500)**
```
Internal Server Error: Erro interno do servidor
```

## Limita√ß√µes e Considera√ß√µes

### **Limite de Registros**
- **M√°ximo**: 100 registros por consulta
- **Padr√£o**: 100 registros (se n√£o especificado)
- **Recomenda√ß√£o**: Use filtros espec√≠ficos para reduzir resultados

### **Performance**
- Consultas com muitos filtros podem ser mais lentas
- Use √≠ndices apropriados nos campos de filtro
- Evite consultas muito amplas sem filtros

### **Formato de Data**
- Use formato brasileiro: `DD/MM/AAAA HH:MM:SS`
- Exemplo: `01/01/2024 10:30:00`

### **Operadores de Filtro**
- **Igualdade**: `=`
- **Maior que**: `>`
- **Maior ou igual**: `>=`
- **Menor que**: `<`
- **Menor ou igual**: `<=`
- **Diferente**: `<>`
- **Cont√©m**: `like %texto%`
- **E l√≥gico**: `and`
- **OU l√≥gico**: `or`

## Pr√≥ximos Passos

<CardGroup cols={2}>
  <Card
    title="Endpoints de Emiss√£o"
    href="/api/endpoints/emission"
    icon="rocket"
  >
    Aprenda a emitir documentos
  </Card>
  <Card
    title="Modelos de Dados"
    href="/api/models/request"
    icon="database"
  >
    Estrutura dos dados de entrada
  </Card>
  <Card
    title="Exemplos de Integra√ß√£o"
    href="/examples/php"
    icon="code"
  >
    Veja exemplos pr√°ticos
  </Card>
  <Card
    title="Suporte"
    href="mailto:suporte@managersaas.com"
    icon="message-circle"
  >
    Entre em contato conosco
  </Card>
</CardGroup>

---

üîç **Consulta Poderosa**: A rota de consulta oferece flexibilidade total para buscar e filtrar CT-e OS conforme suas necessidades espec√≠ficas. Para d√∫vidas sobre filtros ou campos, consulte nossa equipe de suporte. 