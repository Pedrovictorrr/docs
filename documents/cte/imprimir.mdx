---
title: Imprimir um Conhecimento OS
description: Documentação da rota para impressão e geração de PDF do CT-e OS
---

# Imprimir um Conhecimento OS

A rota **Imprime** será utilizada para gerarmos um PDF de um CT-e OS autorizado ou de uma CC-e.

## Endpoint

### GET

```http
GET https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/imprime
```

## Headers

| Nome | Descrição | Exemplo |
|------|-----------|---------|
| `Authorization` | Este usuário e senha são os seus dados para logar como administrador em um grupo do SaaS | `Basic YWRtaW46MTIzbXVkYXI=` |

## Query Parameters

| Nome | Descrição |
|------|-----------|
| `Grupo` | Nome do grupo |
| `CNPJ` | CNPJ que está vinculado ao grupo que será usado para realizar a consulta, apenas números |
| `ChaveNota` | Chave de 44 dígitos da CT-e OS autorizada |
| `Url` | **Define qual será o formato do retorno da requisição**<br/>`0` - Conteúdo binário do arquivo PDF<br/>`1` - URL para download do PDF |

## Exemplos de Uso

### Exemplo 1: Obter Conteúdo Binário do PDF

```bash
curl -X GET "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/imprime?grupo=meugrupo&cnpj=08187168000160&chaveNota=41150408187168000160576660000006671000000012&url=0" \
  -H "Authorization: Basic YWRtaW46MTIzbXVkYXI=" \
  -o cteos.pdf
```

### Exemplo 2: Obter URL para Download do PDF

```bash
curl -X GET "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/imprime?grupo=meugrupo&cnpj=08187168000160&chaveNota=41150408187168000160576660000006671000000012&url=1" \
  -H "Authorization: Basic YWRtaW46MTIzbXVkYXI="
```

### Exemplo 3: Usando JavaScript/Fetch

```javascript
// Obter URL para download
fetch('https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/imprime?grupo=meugrupo&cnpj=08187168000160&chaveNota=41150408187168000160576660000006671000000012&url=1', {
  headers: {
    'Authorization': 'Basic YWRtaW46MTIzbXVkYXI='
  }
})
.then(response => response.text())
.then(url => {
  console.log('URL para download:', url);
  // Abrir URL em nova aba ou fazer download
  window.open(url, '_blank');
});

// Obter conteúdo binário
fetch('https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/imprime?grupo=meugrupo&cnpj=08187168000160&chaveNota=41150408187168000160576660000006671000000012&url=0', {
  headers: {
    'Authorization': 'Basic YWRtaW46MTIzbXVkYXI='
  }
})
.then(response => response.blob())
.then(blob => {
  // Criar URL para o blob
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'cteos.pdf';
  a.click();
  window.URL.revokeObjectURL(url);
});
```

## Respostas

### Exemplo de Retorno com Sucesso

#### URL = 0 (Conteúdo Binário)

Quando `url=0`, a resposta será o conteúdo binário do arquivo PDF. O arquivo pode ser salvo diretamente ou processado conforme necessário.

#### URL = 1 (URL para Download)

Quando `url=1`, a resposta será uma URL para download do PDF:

```text
https://managersaashom.tecnospeed.com.br:7071/ManagerAPIWeb/download/ManagerCTe/201578985111891361.pdf
```

### Exemplo de Retorno com Erro

```text
"Palavra Exception", "Classe da Exception", "Mensagem de Exception"
EXCEPTION, EspdManCTeCheckParamsException, Erro ao montar notas - Formato: t não é aceito
```

## Parâmetros Obrigatórios

1. **`Grupo`** - Nome do grupo configurado no SaaS
2. **`CNPJ`** - CNPJ vinculado ao grupo (apenas números)
3. **`ChaveNota`** - Chave de acesso do CT-e OS (44 dígitos)

## Parâmetros Opcionais

1. **`Url`** - Define o formato de retorno:
   - `0` - Conteúdo binário do PDF
   - `1` - URL para download do PDF

## Casos de Uso

### 1. **Impressão Direta**
- `url=0` - Para obter o PDF e imprimir diretamente
- Útil para aplicações que precisam processar o PDF

### 2. **Download do PDF**
- `url=1` - Para obter uma URL de download
- Útil para aplicações web que querem oferecer download

### 3. **Visualização em Navegador**
- `url=1` - Para abrir o PDF em nova aba
- Ideal para visualização rápida

### 4. **Integração com Sistemas**
- `url=0` - Para processamento automático
- Útil para workflows automatizados

## Requisitos para Impressão

### **CT-e OS**
- Deve estar **autorizado** pela SEFAZ
- Chave deve ser válida (44 dígitos)
- CNPJ deve estar ativo no grupo

### **CC-e (Carta de Correção)**
- Deve estar **vinculada** ao CT-e OS
- CT-e OS deve estar autorizado
- Sequência do evento deve ser válida

## Formatos de Saída

### **PDF Padrão**
- Layout oficial da SEFAZ
- Inclui todas as informações do CT-e OS
- Formato A4 para impressão

### **Conteúdo Binário**
- Arquivo PDF em bytes
- Pode ser salvo com extensão `.pdf`
- Compatível com todos os leitores de PDF

### **URL de Download**
- Link direto para o arquivo
- Arquivo temporário (disponível por tempo limitado)
- Acesso via navegador ou download automático

## Tratamento de Erros

### Erros Comuns

- **"Erro ao montar notas - Formato: t não é aceito"** - Verificar se o CT-e OS está autorizado
- **"CT-e OS não encontrado"** - Verificar se a chave está correta
- **"CNPJ não vinculado ao grupo"** - Verificar se o CNPJ está ativo no grupo
- **"Sem permissão"** - Verificar se o usuário tem permissões adequadas

### Validações

1. Verificar se o CT-e OS existe no sistema
2. Confirmar se o CT-e OS está autorizado
3. Validar se o CNPJ está ativo no grupo
4. Verificar se o usuário tem permissões adequadas
5. Confirmar se a chave tem 44 dígitos

## Exemplos de Implementação

### **Python**

```python
import requests

def imprimir_cteos(grupo, cnpj, chave_nota, url_format=1):
    """
    Imprime um CT-e OS e retorna o PDF ou URL
    """
    url = "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/imprime"
    
    params = {
        'grupo': grupo,
        'cnpj': cnpj,
        'chaveNota': chave_nota,
        'url': url_format
    }
    
    headers = {
        'Authorization': 'Basic YWRtaW46MTIzbXVkYXI='
    }
    
    response = requests.get(url, params=params, headers=headers)
    
    if response.status_code == 200:
        if url_format == 0:
            # Salvar PDF
            with open(f'cteos_{chave_nota}.pdf', 'wb') as f:
                f.write(response.content)
            return f'PDF salvo como cteos_{chave_nota}.pdf'
        else:
            # Retornar URL
            return response.text
    else:
        return f'Erro: {response.text}'

# Exemplo de uso
resultado = imprimir_cteos('meugrupo', '08187168000160', '41150408187168000160576660000006671000000012', 1)
print(resultado)
```

### **PHP**

```php
<?php
function imprimirCTeOS($grupo, $cnpj, $chaveNota, $urlFormat = 1) {
    $url = "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/imprime";
    
    $params = http_build_query([
        'grupo' => $grupo,
        'cnpj' => $cnpj,
        'chaveNota' => $chaveNota,
        'url' => $urlFormat
    ]);
    
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url . '?' . $params);
    curl_setopt($ch, CURLOPT_HTTPHEADER, [
        'Authorization: Basic YWRtaW46MTIzbXVkYXI='
    ]);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    
    $response = curl_exec($ch);
    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);
    
    if ($httpCode == 200) {
        if ($urlFormat == 0) {
            // Salvar PDF
            file_put_contents("cteos_{$chaveNota}.pdf", $response);
            return "PDF salvo como cteos_{$chaveNota}.pdf";
        } else {
            // Retornar URL
            return $response;
        }
    } else {
        return "Erro HTTP: {$httpCode}";
    }
}

// Exemplo de uso
$resultado = imprimirCTeOS('meugrupo', '08187168000160', '41150408187168000160576660000006671000000012', 1);
echo $resultado;
?>
```

## Observações Importantes

1. **Autenticação**: É necessário ter permissões de administrador no grupo
2. **Chave**: A chave deve ser de um CT-e OS autorizado
3. **Formato**: Escolha o formato de retorno conforme sua necessidade
4. **Tamanho**: PDFs podem ser grandes, considere o tempo de download
5. **Cache**: URLs de download são temporárias, não armazene permanentemente
6. **Rate Limiting**: Evite múltiplas requisições simultâneas

## Boas Práticas

1. **Sempre verificar** se o CT-e OS está autorizado antes de imprimir
2. **Usar `url=0`** para processamento automático
3. **Usar `url=1`** para download manual pelo usuário
4. **Implementar tratamento de erros** adequado
5. **Validar parâmetros** antes de fazer a requisição
6. **Considerar o tamanho** dos PDFs para downloads
