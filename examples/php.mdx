---
title: 'Integração Laravel PHP'
description: 'Exemplos práticos de integração com o Green Productivity usando Laravel PHP'
---

# Integração Laravel PHP - Green Productivity

Exemplos práticos de como integrar sua aplicação Laravel com a API do Green Productivity para gestão de operações agrícolas.

## Configuração Inicial

### **1. Instalação de Dependências**

```bash
# Em um projeto Laravel existente
composer require guzzlehttp/guzzle

# Ou criar um novo projeto Laravel
composer create-project laravel/laravel green-productivity-integration
cd green-productivity-integration
composer require guzzlehttp/guzzle
```

### **2. Arquivo de Configuração**

```php
<?php
// config/green_productivity.php

return [
    'api_url' => env('GREEN_PRODUCTIVITY_API_URL', 'https://api.greenproductivity.com/v1'),
    'token' => env('GREEN_PRODUCTIVITY_TOKEN'),
    'fazenda_id' => env('GREEN_PRODUCTIVITY_FAZENDA_ID'),
    'ambiente' => env('GREEN_PRODUCTIVITY_ENVIRONMENT', 'production'),
    'timeout' => env('GREEN_PRODUCTIVITY_TIMEOUT', 30),
    'retries' => env('GREEN_PRODUCTIVITY_RETRIES', 3),
    'webhook_url' => env('GREEN_PRODUCTIVITY_WEBHOOK_URL'),
    'log_channel' => env('GREEN_PRODUCTIVITY_LOG_CHANNEL', 'stack'),
];
```

### **3. Variáveis de Ambiente**

```bash
# .env
GREEN_PRODUCTIVITY_API_URL=https://api.greenproductivity.com/v1
GREEN_PRODUCTIVITY_TOKEN=seu_token_aqui
GREEN_PRODUCTIVITY_FAZENDA_ID=sua_fazenda_id
GREEN_PRODUCTIVITY_ENVIRONMENT=production
GREEN_PRODUCTIVITY_TIMEOUT=30
GREEN_PRODUCTIVITY_RETRIES=3
GREEN_PRODUCTIVITY_WEBHOOK_URL=https://seu-site.com/webhook
```

## Cliente Principal

### **Classe GreenProductivityClient**

```php
<?php
// src/GreenProductivity/GreenProductivityClient.php

namespace App\GreenProductivity;

use GuzzleHttp\Client;
use GuzzleHttp\Exception\RequestException;
use Illuminate\Support\Facades\Log;

class GreenProductivityClient
{
    private Client $httpClient;
    private array $config;
    
    public function __construct(array $config)
    {
        $this->config = $config;
        
        $this->httpClient = new Client([
            'base_uri' => $config['api_url'],
            'timeout' => $config['timeout'],
            'headers' => [
                'Authorization' => 'Bearer ' . $config['token'],
                'Content-Type' => 'application/json',
                'User-Agent' => 'GreenProductivity-Laravel-Client/1.0'
            ]
        ]);
    }
    
    /**
     * Cadastra uma nova área
     */
    public function cadastrarArea(array $dados): array
    {
        try {
            $response = $this->httpClient->post('/areas', [
                'json' => $dados
            ]);
            
            $resultado = json_decode($response->getBody()->getContents(), true);
            
            Log::channel($this->config['log_channel'])->info('Área cadastrada com sucesso', [
                'nome' => $resultado['data']['nome'] ?? null,
                'dados' => $dados
            ]);
            
            return $resultado;
            
        } catch (RequestException $e) {
            Log::channel($this->config['log_channel'])->error('Erro ao cadastrar área', [
                'error' => $e->getMessage(),
                'dados' => $dados
            ]);
            
            throw new GreenProductivityException(
                'Erro ao cadastrar área: ' . $e->getMessage(),
                $e->getCode(),
                $e
            );
        }
    }
    
    /**
     * Cria uma nova tarefa agrícola
     */
    public function criarTarefa(array $dados): array
    {
        try {
            $response = $this->httpClient->post('/tarefas', [
                'json' => $dados
            ]);
            
            $resultado = json_decode($response->getBody()->getContents(), true);
            
            Log::channel($this->config['log_channel'])->info('Tarefa criada com sucesso', [
                'nome' => $resultado['data']['nome'] ?? null,
                'dados' => $dados
            ]);
            
            return $resultado;
            
        } catch (RequestException $e) {
            Log::channel($this->config['log_channel'])->error('Erro ao criar tarefa', [
                'error' => $e->getMessage(),
                'dados' => $dados
            ]);
            
            throw new GreenProductivityException(
                'Erro ao criar tarefa: ' . $e->getMessage(),
                $e->getCode(),
                $e
            );
        }
    }
    
    /**
     * Consulta o status de uma atividade
     */
    public function consultarAtividade(string $id): array
    {
        try {
            $response = $this->httpClient->get("/atividades/{$id}");
            
            return json_decode($response->getBody()->getContents(), true);
            
        } catch (RequestException $e) {
            Log::channel($this->config['log_channel'])->error('Erro ao consultar atividade', [
                'id' => $id,
                'error' => $e->getMessage()
            ]);
            
            throw new GreenProductivityException(
                'Erro ao consultar atividade: ' . $e->getMessage(),
                $e->getCode(),
                $e
            );
        }
    }
    
    /**
     * Registra uma parada operacional
     */
    public function registrarParada(array $dados): array
    {
        try {
            $response = $this->httpClient->post('/paradas', [
                'json' => $dados
            ]);
            
            $resultado = json_decode($response->getBody()->getContents(), true);
            
            Log::channel($this->config['log_channel'])->info('Parada registrada com sucesso', [
                'tipo' => $resultado['data']['tipo'] ?? null,
                'dados' => $dados
            ]);
            
            return $resultado;
            
        } catch (RequestException $e) {
            Log::channel($this->config['log_channel'])->error('Erro ao registrar parada', [
                'error' => $e->getMessage(),
                'dados' => $dados
            ]);
            
            throw new GreenProductivityException(
                'Erro ao registrar parada: ' . $e->getMessage(),
                $e->getCode(),
                $e
            );
        }
    }
    
    /**
     * Gera relatório de produtividade
     */
    public function gerarRelatorio(string $tipo, array $filtros = []): array
    {
        try {
            $response = $this->httpClient->get("/relatorios/{$tipo}", [
                'query' => $filtros
            ]);
            
            return json_decode($response->getBody()->getContents(), true);
            
        } catch (RequestException $e) {
            Log::channel($this->config['log_channel'])->error('Erro ao gerar relatório', [
                'tipo' => $tipo,
                'filtros' => $filtros,
                'error' => $e->getMessage()
            ]);
            
            throw new GreenProductivityException(
                'Erro ao gerar relatório: ' . $e->getMessage(),
                $e->getCode(),
                $e
            );
        }
    }
}
```

## Exemplos de Uso

### **1. Cadastro de Área**

```php
<?php
// examples/cadastrar_area_example.php

require_once 'vendor/autoload.php';

use App\GreenProductivity\GreenProductivityClient;

// Carrega configuração
$config = require 'config/green_productivity.php';
$client = new GreenProductivityClient($config);

// Dados para cadastro de área
$dadosArea = [
    'nome' => 'Talhão 01 - Soja',
    'fazenda_id' => $config['fazenda_id'],
    'area_hectares' => 25.5,
    'localizacao' => [
        'latitude' => -15.7942,
        'longitude' => -47.8822
    ],
    'cultura_principal' => 'Soja',
    'variedade' => 'BRS 123',
    'solo' => [
        'tipo' => 'Latossolo Vermelho',
        'ph' => 6.2,
        'fertilidade' => 'Alta'
    ]
];

try {
    // Cadastra a área
    $resultado = $client->cadastrarArea($dadosArea);
    
    echo "Área cadastrada com sucesso!\n";
    echo "ID: " . $resultado['data']['id'] . "\n";
    echo "Nome: " . $resultado['data']['nome'] . "\n";
    echo "Área: " . $resultado['data']['area_hectares'] . " hectares\n";
    
    // Salva no banco de dados local
    $this->salvarArea($resultado['data']);
    
} catch (Exception $e) {
    echo "Erro ao cadastrar área: " . $e->getMessage() . "\n";
}
```

### **2. Criação de Tarefa Agrícola**

```php
<?php
// examples/criar_tarefa_example.php

require_once 'vendor/autoload.php';

use App\GreenProductivity\GreenProductivityClient;

$config = require 'config/green_productivity.php';
$client = new GreenProductivityClient($config);

// Dados para criação de tarefa
$dadosTarefa = [
    'nome' => 'Plantio Soja - Talhão 01',
    'descricao' => 'Plantio de soja no talhão 01 com semente BRS 123',
    'tipo' => 'PLANTIO',
    'area_id' => 1,
    'equipe_id' => 5,
    'data_prevista_inicio' => '2024-10-15',
    'data_prevista_fim' => '2024-10-17',
    'recursos_necessarios' => [
        [
            'produto_id' => 10,
            'quantidade' => 50,
            'unidade' => 'kg'
        ],
        [
            'equipamento_id' => 2,
            'horas_uso' => 16
        ]
    ],
    'prioridade' => 'ALTA',
    'observacoes' => 'Verificar umidade do solo antes do plantio'
];

try {
    $resultado = $client->criarTarefa($dadosTarefa);
    
    echo "Tarefa criada com sucesso!\n";
    echo "ID: " . $resultado['data']['id'] . "\n";
    echo "Nome: " . $resultado['data']['nome'] . "\n";
    echo "Status: " . $resultado['data']['status'] . "\n";
    
} catch (Exception $e) {
    echo "Erro ao criar tarefa: " . $e->getMessage() . "\n";
}
```

### **3. Monitoramento de Atividades**

```php
<?php
// examples/monitorar_atividades_example.php

require_once 'vendor/autoload.php';

use App\GreenProductivity\GreenProductivityClient;

$config = require 'config/green_productivity.php';
$client = new GreenProductivityClient($config);

// Lista de atividades para monitorar
$atividades = [
    'ATV001', 'ATV002', 'ATV003'
];

echo "Monitorando atividades agrícolas...\n\n";

foreach ($atividades as $id) {
    try {
        $atividade = $client->consultarAtividade($id);
        
        echo "Atividade {$id}: {$atividade['data']['status']}\n";
        echo "  Progresso: {$atividade['data']['progresso']}%\n";
        echo "  Área: {$atividade['data']['area']['nome']}\n";
        echo "  Equipe: {$atividade['data']['equipe']['nome']}\n";
        
        // Se concluída, gera relatório
        if ($atividade['data']['status'] === 'CONCLUIDA') {
            $this->gerarRelatorioAtividade($client, $id);
        }
        
    } catch (Exception $e) {
        echo "Erro ao consultar atividade {$id}: " . $e->getMessage() . "\n";
    }
    
    echo "\n";
}

function gerarRelatorioAtividade(GreenProductivityClient $client, string $id): void
{
    try {
        $relatorio = $client->gerarRelatorio('atividade', ['atividade_id' => $id]);
        
        echo "  ✓ Relatório gerado com sucesso\n";
        echo "    Produtividade: {$relatorio['data']['produtividade']} kg/ha\n";
        echo "    Eficiência: {$relatorio['data']['eficiencia']}%\n";
        
    } catch (Exception $e) {
        echo "  ✗ Erro ao gerar relatório: " . $e->getMessage() . "\n";
    }
}
```

## Integração com Laravel

### **Service Provider**

```php
<?php
// app/Providers/GreenProductivityServiceProvider.php

namespace App\Providers;

use Illuminate\Support\ServiceProvider;
use App\GreenProductivity\GreenProductivityClient;

class GreenProductivityServiceProvider extends ServiceProvider
{
    public function register(): void
    {
        $this->app->singleton(GreenProductivityClient::class, function ($app) {
            $config = config('green_productivity');
            
            return new GreenProductivityClient($config);
        });
    }
    
    public function boot(): void
    {
        $this->publishes([
            __DIR__.'/../../config/green_productivity.php' => config_path('green_productivity.php'),
        ], 'green-productivity');
    }
}
```

### **Controller de Exemplo**

```php
<?php
// app/Http/Controllers/AgriculturaController.php

namespace App\Http\Controllers;

use App\GreenProductivity\GreenProductivityClient;
use Illuminate\Http\Request;
use Illuminate\Http\JsonResponse;

class AgriculturaController extends Controller
{
    public function __construct(
        private GreenProductivityClient $greenProductivity
    ) {}
    
    /**
     * Cadastra uma nova área
     */
    public function cadastrarArea(Request $request): JsonResponse
    {
        $request->validate([
            'nome' => 'required|string',
            'area_hectares' => 'required|numeric|min:0',
            'localizacao.latitude' => 'required|numeric',
            'localizacao.longitude' => 'required|numeric',
            'cultura_principal' => 'required|string'
        ]);
        
        try {
            $resultado = $this->greenProductivity->cadastrarArea($request->all());
            
            return response()->json([
                'success' => true,
                'data' => $resultado['data']
            ]);
            
        } catch (\Exception $e) {
            return response()->json([
                'success' => false,
                'message' => $e->getMessage()
            ], 500);
        }
    }
    
    /**
     * Cria uma nova tarefa
     */
    public function criarTarefa(Request $request): JsonResponse
    {
        $request->validate([
            'nome' => 'required|string',
            'tipo' => 'required|string',
            'area_id' => 'required|integer',
            'equipe_id' => 'required|integer',
            'data_prevista_inicio' => 'required|date'
        ]);
        
        try {
            $resultado = $this->greenProductivity->criarTarefa($request->all());
            
            return response()->json([
                'success' => true,
                'data' => $resultado['data']
            ]);
            
        } catch (\Exception $e) {
            return response()->json([
                'success' => false,
                'message' => $e->getMessage()
            ], 500);
        }
    }
    
    /**
     * Registra uma parada
     */
    public function registrarParada(Request $request): JsonResponse
    {
        $request->validate([
            'tipo' => 'required|string',
            'motivo' => 'required|string',
            'inicio' => 'required|date',
            'atividade_id' => 'required|integer'
        ]);
        
        try {
            $resultado = $this->greenProductivity->registrarParada($request->all());
            
            return response()->json([
                'success' => true,
                'data' => $resultado['data']
            ]);
            
        } catch (\Exception $e) {
            return response()->json([
                'success' => false,
                'message' => $e->getMessage()
            ], 500);
        }
    }
}
```

### **Rotas**

```php
<?php
// routes/api.php

Route::prefix('agricultura')->group(function () {
    Route::post('/areas', [AgriculturaController::class, 'cadastrarArea']);
    Route::post('/tarefas', [AgriculturaController::class, 'criarTarefa']);
    Route::post('/paradas', [AgriculturaController::class, 'registrarParada']);
    Route::get('/atividades/{id}', [AgriculturaController::class, 'consultarAtividade']);
    Route::get('/relatorios/{tipo}', [AgriculturaController::class, 'gerarRelatorio']);
});
```

## Tratamento de Erros

### **Classe de Exceção Personalizada**

```php
<?php
// src/GreenProductivity/GreenProductivityException.php

namespace App\GreenProductivity;

class GreenProductivityException extends \Exception
{
    private array $context;
    
    public function __construct(string $message, int $code = 0, \Throwable $previous = null, array $context = [])
    {
        parent::__construct($message, $code, $previous);
        $this->context = $context;
    }
    
    public function getContext(): array
    {
        return $this->context;
    }
    
    public function isRetryable(): bool
    {
        // Códigos que podem ser tentados novamente
        $retryableCodes = [408, 429, 500, 502, 503, 504];
        
        return in_array($this->getCode(), $retryableCodes);
    }
}
```

## Testes

### **Teste Unitário**

```php
<?php
// tests/Unit/GreenProductivityClientTest.php

namespace Tests\Unit;

use Tests\TestCase;
use App\GreenProductivity\GreenProductivityClient;
use GuzzleHttp\Client;
use GuzzleHttp\Handler\MockHandler;
use GuzzleHttp\HandlerStack;
use GuzzleHttp\Psr7\Response;

class GreenProductivityClientTest extends TestCase
{
    private GreenProductivityClient $client;
    
    protected function setUp(): void
    {
        parent::setUp();
        
        // Mock do cliente HTTP
        $mock = new MockHandler([
            new Response(200, [], json_encode([
                'status' => 'success',
                'data' => [
                    'id' => 1,
                    'nome' => 'Talhão Teste',
                    'area_hectares' => 25.5
                ]
            ]))
        ]);
        
        $handlerStack = HandlerStack::create($mock);
        $httpClient = new Client(['handler' => $handlerStack]);
        
        $this->client = new GreenProductivityClient([
            'api_url' => 'https://api.test.com',
            'token' => 'test_token'
        ]);
        
        // Injeta o cliente HTTP mockado
        $reflection = new \ReflectionClass($this->client);
        $property = $reflection->getProperty('httpClient');
        $property->setAccessible(true);
        $property->setValue($this->client, $httpClient);
    }
    
    public function test_cadastra_area_com_sucesso(): void
    {
        $dados = [
            'nome' => 'Talhão Teste',
            'area_hectares' => 25.5,
            'cultura_principal' => 'Soja'
        ];
        
        $resultado = $this->client->cadastrarArea($dados);
        
        $this->assertEquals('success', $resultado['status']);
        $this->assertEquals('Talhão Teste', $resultado['data']['nome']);
        $this->assertEquals(25.5, $resultado['data']['area_hectares']);
    }
}
```

## Próximos Passos

<CardGroup cols={2}>
  <Card
    title="Outras Linguagens"
    href="/examples/nodejs"
    icon="code"
  >
    Veja exemplos práticos em Node.js
  </Card>
  <Card
    title="Referência da API"
    href="/api/endpoints/areas"
    icon="book"
  >
    Explore todos os endpoints disponíveis
  </Card>
  <Card
    title="Dashboard Web"
    href="/dashboard/overview"
    icon="monitor"
  >
    Interface web para gestão
  </Card>
  <Card
    title="Suporte"
    href="mailto:suporte@greenproductivity.com"
    icon="message-circle"
  >
    Entre em contato conosco
  </Card>
</CardGroup>

---

🌱 **Código Pronto para Produção**: Todos os exemplos incluem tratamento de erros, logging e boas práticas para uso em ambiente de produção agrícola. 