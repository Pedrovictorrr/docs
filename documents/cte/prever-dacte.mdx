---
title: Pré-visualizar a Nota - DACTE
description: Documentação da rota para pré-visualização do DACTE do CT-e OS antes da autorização
---

# Pré-visualizar a Nota - DACTE

A rota **Prever** será utilizada para gerarmos a previsão do DACTE de um CT-e OS que ainda não foi autorizado. Ela pode ser utilizada, por exemplo, nos casos em que se deseja realizar uma conferência dos dados que serão impressos após a autorização do CT-e OS.

## Endpoint

### POST

```http
POST https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/prever
```

## Headers

| Nome | Descrição | Exemplo |
|------|-----------|---------|
| `Authorization` | Este usuário e senha são os seus dados para logar como administrador em um grupo do SaaS | `Basic YWRtaW46MTIzbXVkYXI=` |

## Body Parameters

| Nome | Descrição |
|------|-----------|
| `Grupo` | Nome do grupo |
| `CNPJ` | CNPJ do emitente do CT-e OS, apenas números |
| `Arquivo` | Conteúdo do TX2 ou XML |
| `URL` | **Define qual será o formato do retorno da requisição**<br/>`0` - Conteúdo binário do arquivo PDF<br/>`1` - URL para download do PDF |

## Exemplos de Uso

### Exemplo 1: Obter Conteúdo Binário do PDF

```bash
curl -X POST "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/prever" \
  -H "Authorization: Basic YWRtaW46MTIzbXVkYXI=" \
  -d "Grupo=meugrupo&CNPJ=08187168000160&Arquivo=CONTEUDO_DO_TX2&URL=0" \
  -o dacte_preview.pdf
```

### Exemplo 2: Obter URL para Download do PDF

```bash
curl -X POST "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/prever" \
  -H "Authorization: Basic YWRtaW46MTIzbXVkYXI=" \
  -d "Grupo=meugrupo&CNPJ=08187168000160&Arquivo=CONTEUDO_DO_TX2&URL=1"
```

### Exemplo 3: Usando JavaScript/Fetch

```javascript
// Obter URL para download
fetch('https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/prever', {
  method: 'POST',
  headers: {
    'Authorization': 'Basic YWRtaW46MTIzbXVkYXI='
  },
  body: new URLSearchParams({
    'Grupo': 'meugrupo',
    'CNPJ': '08187168000160',
    'Arquivo': 'CONTEUDO_DO_TX2',
    'URL': '1'
  })
})
.then(response => response.text())
.then(url => {
  console.log('URL para download:', url);
  // Abrir URL em nova aba ou fazer download
  window.open(url, '_blank');
});

// Obter conteúdo binário
fetch('https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/prever', {
  method: 'POST',
  headers: {
    'Authorization': 'Basic YWRtaW46MTIzbXVkYXI='
  },
  body: new URLSearchParams({
    'Grupo': 'meugrupo',
    'CNPJ': '08187168000160',
    'Arquivo': 'CONTEUDO_DO_TX2',
    'URL': '0'
  })
})
.then(response => response.blob())
.then(blob => {
  // Criar URL para o blob
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'dacte_preview.pdf';
  a.click();
  window.URL.revokeObjectURL(url);
});
```

## Respostas

### Exemplo de Retorno com Sucesso

#### URL = 0 (Conteúdo Binário)

Quando `URL=0`, a resposta será o conteúdo binário do arquivo PDF. O arquivo pode ser salvo diretamente ou processado conforme necessário.

#### URL = 1 (URL para Download)

Quando `URL=1`, a resposta será uma URL para download do PDF:

```text
https://managersaashom.tecnospeed.com.br:7071/ManagerAPIWeb/download/ManagerCTeOS/43190204086596000145578470000000021000000032.pdf
```

### Exemplo de Retorno com Erro

```text
"Palavra Exception", "Classe da Exception", "Mensagem de Exception"
EXCEPTION,EspdAPIWebServerErrorException,Erro ao montar notas: Formato: t não é aceito
```

## Parâmetros Obrigatórios

1. **`Grupo`** - Nome do grupo configurado no SaaS
2. **`CNPJ`** - CNPJ do emitente (apenas números)
3. **`Arquivo`** - Conteúdo do TX2 ou XML do CT-e OS

## Parâmetros Opcionais

1. **`URL`** - Define o formato de retorno:
   - `0` - Conteúdo binário do PDF
   - `1` - URL para download do PDF

## Casos de Uso

### 1. **Pré-visualização Antes da Autorização**
- Verificar layout do DACTE
- Conferir dados que serão impressos
- Validar formatação do documento

### 2. **Conferência de Dados**
- Revisar informações do CT-e OS
- Verificar campos obrigatórios
- Confirmar valores e descrições

### 3. **Teste de Layout**
- Verificar templates de impressão
- Testar diferentes configurações
- Validar formatação personalizada

### 4. **Documentação Interna**
- Gerar prévias para aprovação
- Criar documentação de processos
- Preparar materiais de treinamento

## Diferenças entre Pré-visualização e Impressão

| Aspecto | Pré-visualização (Prever) | Impressão (Imprime) |
|---------|---------------------------|---------------------|
| **Status do CT-e OS** | Não autorizado | Autorizado |
| **Finalidade** | Conferência e validação | Documento oficial |
| **Validade** | Apenas para conferência | Documento válido |
| **Uso** | Interno/desenvolvimento | Cliente/SEFAZ |
| **Dados** | Baseado no TX2/XML enviado | Baseado no CT-e OS autorizado |

## Requisitos para Pré-visualização

### **Arquivo TX2/XML**
- Deve estar no formato correto
- Todos os campos obrigatórios preenchidos
- Estrutura válida conforme especificação

### **Configurações do Sistema**
- Template de impressão configurado
- Layout do DACTE definido
- Configurações de impressora válidas

## Formatos de Saída

### **PDF Padrão**
- Layout idêntico ao DACTE oficial
- Inclui todas as informações do TX2/XML
- Formato A4 para impressão

### **Conteúdo Binário**
- Arquivo PDF em bytes
- Pode ser salvo com extensão `.pdf`
- Compatível com todos os leitores de PDF

### **URL de Download**
- Link direto para o arquivo
- Arquivo temporário (disponível por tempo limitado)
- Acesso via navegador ou download automático

## Exemplos de Implementação

### **Python**

```python
import requests

def prever_dacte_cteos(grupo, cnpj, arquivo_tx2, url_format=1):
    """
    Gera pré-visualização do DACTE do CT-e OS
    """
    url = "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/prever"
    
    data = {
        'Grupo': grupo,
        'CNPJ': cnpj,
        'Arquivo': arquivo_tx2,
        'URL': url_format
    }
    
    headers = {
        'Authorization': 'Basic YWRtaW46MTIzbXVkYXI='
    }
    
    response = requests.post(url, data=data, headers=headers)
    
    if response.status_code == 200:
        if url_format == 0:
            # Salvar PDF
            with open('dacte_preview.pdf', 'wb') as f:
                f.write(response.content)
            return 'PDF salvo como dacte_preview.pdf'
        else:
            # Retornar URL
            return response.text
    else:
        return f'Erro: {response.text}'

# Exemplo de uso
arquivo_tx2 = """
formato=tx2
incluirCTeOS
cUF_6=41
cCT_7=06021956
CFOP_8=5352
natOp_9=Aquisicao
mod_10=67
serie_11=2
nCT_12=489
dhEmi_13=2024-01-15T10:01:01-03:00
# ... resto do TX2
salvarCTeOS
"""

resultado = prever_dacte_cteos('meugrupo', '08187168000160', arquivo_tx2, 1)
print(resultado)
```

### **PHP**

```php
<?php
function preverDACTECTeOS($grupo, $cnpj, $arquivoTx2, $urlFormat = 1) {
    $url = "https://managersaas.tecnospeed.com.br:8081/ManagerAPIWeb/cteos/prever";
    
    $data = http_build_query([
        'Grupo' => $grupo,
        'CNPJ' => $cnpj,
        'Arquivo' => $arquivoTx2,
        'URL' => $urlFormat
    ]);
    
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_POST, true);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
    curl_setopt($ch, CURLOPT_HTTPHEADER, [
        'Authorization: Basic YWRtaW46MTIzbXVkYXI='
    ]);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    
    $response = curl_exec($ch);
    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);
    
    if ($httpCode == 200) {
        if ($urlFormat == 0) {
            // Salvar PDF
            file_put_contents("dacte_preview.pdf", $response);
            return "PDF salvo como dacte_preview.pdf";
        } else {
            // Retornar URL
            return $response;
        }
    } else {
        return "Erro HTTP: {$httpCode} - {$response}";
    }
}

// Exemplo de uso
$arquivoTx2 = "formato=tx2\nincluirCTeOS\ncUF_6=41\ncCT_7=06021956\n# ... resto do TX2\nsalvarCTeOS";

$resultado = preverDACTECTeOS('meugrupo', '08187168000160', $arquivoTx2, 1);
echo $resultado;
?>
```

## Fluxo de Pré-visualização

```
CT-e OS em Preparação
         ↓
    Arquivo TX2/XML
         ↓
    Enviar para Pré-visualização
         ↓
    Sistema Gera DACTE
         ↓
    Retorna PDF ou URL
         ↓
    Conferir Dados
         ↓
    Aprovar ou Corrigir
```

## Observações Importantes

1. **Não é autorização**: A pré-visualização não envia o CT-e OS para a SEFAZ
2. **Dados de teste**: Use dados fictícios para testes
3. **Layout idêntico**: O PDF gerado é idêntico ao oficial
4. **Validação**: Use para conferir dados antes do envio
5. **Templates**: Configurações de impressão devem estar corretas
6. **Tamanho**: PDFs podem ser grandes, considere o tempo de geração

## Tratamento de Erros

### Erros Comuns

- **"Formato: t não é aceito"** - Verificar se o TX2 está correto
- **"Erro ao montar notas"** - Verificar estrutura do arquivo
- **"Campos obrigatórios"** - Verificar se todos os campos estão preenchidos
- **"Template não encontrado"** - Verificar configurações de impressão

### Validações

1. Verificar se o arquivo TX2/XML está no formato correto
2. Confirmar se todos os campos obrigatórios estão preenchidos
3. Validar se o CNPJ está ativo no grupo
4. Verificar se o usuário tem permissões adequadas
5. Confirmar se as configurações de impressão estão corretas

## Boas Práticas

1. **Use para conferência** antes de enviar para autorização
2. **Teste com dados fictícios** para validar layout
3. **Verifique todos os campos** antes de aprovar
4. **Compare com templates** oficiais da SEFAZ
5. **Implemente validações** no sistema antes da pré-visualização
6. **Documente processos** de conferência e aprovação