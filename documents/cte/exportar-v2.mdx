---
title: Exportar Notas V2
description: Documentação da rota V2 para exportação em lote de XMLs e PDFs do CT-e OS
---

# Exportar Notas V2

A Rota **Exporta V2** foi criada para realizar a geração de vários XML's e PDF's de uma só vez em um arquivo .zip, todos os XML's e PDF's emitidos e destinados a um CNPJ.

Para a exportação de XML e PDF, utilize o parâmetro `"pdf": true`.

**Observação:** Esta rota é **assíncrona**, guarde o protocolo retornado para que possa consultar a situação de sua exportação.

## Observações Importantes

- **Período máximo**: 31 dias para exportação
- **Campos de data**: `dataInicial` e `dataFinal` são referentes à data de emissão do documento
- **Disponibilidade**: O arquivo .zip ficará disponível para download por 15 dias
- **Timeout**: Caso um protocolo não seja concluído em até 40 minutos, será possível refazer uma nova requisição

## Endpoints Disponíveis

A rota pode ser utilizada na exportação de todos os documentos, basta substituir o nome do documento nas requisições:

- **CF-e SAT**: `/api/v2/cfesat/exporta`
- **CT-e**: `/api/v2/cte/exporta`
- **MDF-e**: `/api/v2/mdfe/exporta`
- **NFSe**: `/api/v2/nfse/exporta`
- **NFe**: `/api/v2/nfe/exporta`
- **NFC-e**: `/api/v2/nfce/exporta`
- **CT-e OS**: `/api/v2/cteos/exporta`

## Fluxo de Exportação

A exportação é realizada em 4 passos:

1. **Exportar documentos** - Solicitar a exportação
2. **Consultar protocolo** - Verificar o status do processamento
3. **Baixar XML's** - Download dos arquivos XML
4. **Baixar PDF's** - Download dos arquivos PDF

## 1º Passo - Exportar Documentos

### POST

```http
POST https://managersaas.tecnospeed.com.br:8081/api/v2/cteos/exporta?grupo=SeuGrupo&cnpj=29062609000177
```

### Headers

| Nome | Descrição | Exemplo |
|------|-----------|---------|
| `Content-Type` | Indica o tipo de arquivo | `application/json` |
| `Authorization` | Este usuário e senha são os seus dados para logar como administrador em um grupo do SaaS | `Basic YWRtaW46MTIzbXVkYXI=` |

### Query Parameters

| Nome | Descrição |
|------|-----------|
| `Grupo` | Nome do grupo |
| `CNPJ` | CNPJ que está vinculado ao grupo que será usado para enviar a requisição de exporta, apenas números |

### Body

#### Exemplo Básico

```json
{
    "dataInicial": "2021-01-27",
    "dataFinal": "2021-01-28",
    "pdf": false
}
```

#### Exemplo com Parâmetros de Numeração

```json
{
    "dataInicial": "2021-01-27",
    "dataFinal": "2021-01-28",
    "pdf": false,
    "serie": "123",
    "numeroInicial": "1",
    "numeroFinal": "2"
}
```

### Retorno

#### Exemplo de Retorno com Sucesso

```json
{
    "mensagem": "Nota(as) em processamento",
    "protocolo": "f1b740ba-6899-4d80-83e8-43dacfb04351"
}
```

#### Exemplo de Retorno com Erro

```json
{
    "mensagem": "dataInicial e dataFinal não podem ultrapassar limite de 31 dias de diferença."
}
```

## 2º Passo - Consultar Protocolo

### GET

```http
GET https://managersaas.tecnospeed.com.br:8081/api/v2/cteos/exporta/:protocol?grupo=SeuGrupo&cnpj=29062609000177
```

### Headers

| Nome | Descrição | Exemplo |
|------|-----------|---------|
| `Content-Type` | Indica o tipo de arquivo | `application/json` |
| `Authorization` | Este usuário e senha são os seus dados para logar como administrador em um grupo do SaaS | `Basic YWRtaW46MTIzbXVkYXI=` |

### Query Parameters

| Nome | Descrição |
|------|-----------|
| `Grupo` | Nome do grupo |
| `CNPJ` | CNPJ que está vinculado ao grupo que será usado para enviar a requisição de exporta, apenas números |

### Path Variables

| Nome | Descrição |
|------|-----------|
| `protocol` | Número do protocolo adquirido no retorno da consulta do 1º passo realizado desta rota |

### Retorno

#### Exemplo de Retorno - Operação Concluída

```json
{
    "mensagem": "Operação concluída, utilize a URL para baixar seus arquivos.",
    "protocolo": "57cd901d-4a80-4235-bac0-fc75dacf4d58",
    "filtros": {
        "dataInicial": "2020-01-01",
        "dataFinal": "2020-01-30",
        "pdf": true
    },
    "xmls": {
        "situacao": "CONCLUIDO",
        "url": "https://managersaas.tecnospeed.com.br:8081/api/v2/cteos/exporta/57cd405d-3a60-4235-bac0-fc75dacf4d57/xml"
    },
    "pdfs": {
        "situacao": "CONCLUIDO",
        "url": "https://managersaas.tecnospeed.com.br:8081/api/v2/cteos/exporta/57cd103e-4a84-4215-bac0-fc75ddrf3d13/pdf"
    }
}
```

#### Exemplo de Retorno com Erro

```json
{
    "mensagem": "EXCEPTION|EspdConsultaException|Erro ao obter dados da consulta. Tente novamente mais tarde.",
    "protocolo": "33186c7c-abae-4dc2-87ad-dab39b9df835"
}
```

#### Exemplo de Retorno - Sem Dados

```json
{
    "mensagem": "Operação concluída, nenhum registro encontrado para o filtro utilizado.",
    "protocolo": "417de89c-e698-4297-abdb-c9355ccac794",
    "filtros": {
        "dataInicial": "2018-04-01",
        "dataFinal": "2018-04-30"
    }
}
```

#### Exemplo de Retorno - Timeout

```json
{
    "mensagem": "Timeout de 40m0s excedido para exportação",
    "protocolo": "e43bbfc4-a78b-4bf7-8691-9f9158d74a2b"
}
```

## 3º Passo - Baixar XML's

### GET

```http
GET https://managersaas.tecnospeed.com.br:8081/api/v2/cteos/exporta/:protocol/xml?grupo=SeuGrupo&cnpj=29062609000177
```

### Headers

| Nome | Descrição | Exemplo |
|------|-----------|---------|
| `Content-Type` | Indica o tipo de arquivo | `application/json` |
| `Authorization` | Este usuário e senha são os seus dados para logar como administrador em um grupo do SaaS | `Basic YWRtaW46MTIzbXVkYXI=` |

### Query Parameters

| Nome | Descrição |
|------|-----------|
| `Grupo` | Nome do grupo |
| `CNPJ` | CNPJ que está vinculado ao grupo que será usado para enviar a requisição de exporta, apenas números |

### Path Variables

| Nome | Descrição |
|------|-----------|
| `protocol` | Número do protocolo adquirido no retorno da consulta do 1º passo realizado desta rota |

### Retorno

#### Exemplo de Retorno - Sem Dados

```json
{
    "mensagem": "Nenhum registro encontrado.",
    "protocolo": "57cd935d-4a80-4235-bac0-fc75dacf4d5"
}
```

#### Exemplo de Retorno - Com Dados

Será recebido uma resposta com dados binários onde será preciso realizar a conversão para salvar o arquivo zip.

O arquivo zip irá separar as notas emitidas e as recebidas por pasta.

## 4º Passo - Baixar PDF's

### GET

```http
GET https://managersaas.tecnospeed.com.br:8081/api/v2/cteos/exporta/:protocol/pdf?grupo=SeuGrupo&cnpj=29062609000177
```

### Headers

| Nome | Descrição | Exemplo |
|------|-----------|---------|
| `Content-Type` | Indica o tipo de arquivo | `application/json` |
| `Authorization` | Este usuário e senha são os seus dados para logar como administrador em um grupo do SaaS | `Basic YWRtaW46MTIzbXVkYXI=` |

### Query Parameters

| Nome | Descrição |
|------|-----------|
| `Grupo` | Nome do grupo |
| `CNPJ` | CNPJ que está vinculado ao grupo que será usado para enviar a requisição de exporta, apenas números |

### Path Variables

| Nome | Descrição |
|------|-----------|
| `protocol` | Número do protocolo adquirido no retorno da consulta do 1º passo realizado desta rota |

### Retorno

#### Exemplo de Retorno - Sem Dados

```json
{
    "mensagem": "Nenhum registro encontrado.",
    "protocolo": "57cd935d-4a80-4235-bac0-fc75dacf4d5"
}
```

#### Exemplo de Retorno - Com Dados

Será recebido uma resposta com dados binários onde será preciso realizar a conversão para salvar o arquivo zip.

O arquivo zip irá separar as notas emitidas e as recebidas por pasta.

## Estrutura do Arquivo ZIP

O arquivo ZIP gerado contém a seguinte estrutura:

```
arquivo_exportacao.zip
├── emitidas/
│   ├── chave1.xml
│   ├── chave2.xml
│   └── ...
├── recebidas/
│   ├── chave3.xml
│   ├── chave4.xml
│   └── ...
├── emitidas_pdf/
│   ├── chave1.pdf
│   ├── chave2.pdf
│   └── ...
└── recebidas_pdf/
    ├── chave3.pdf
    ├── chave4.pdf
    └── ...
```

## ⚠️ ATENÇÃO

**Arquivos PDF na pasta "recebidas":**

Os arquivos .pdf dentro da pasta "recebidas" são referentes às notas retornadas na consulta de destinadas. Elas podem ou não conter o XML destinatário, isso varia de acordo com a manifestação da ciência da operação da nota.

**Se não foi feito o manifesto, elas não terão esse XML e nesse caso não será possível imprimi-las.** Dentro da pasta terá um arquivo assim: `"chave_da_nota-cteos.erro"` com o conteúdo:

```text
EXCEPTION,EspdAPIWebServerErrorException,Não foi possível imprimir a nota pois não existe xml destinatário
```

## Exemplos de Uso

### Exemplo 1: Exportação Básica

```bash
# 1. Solicitar exportação
curl -X POST "https://managersaas.tecnospeed.com.br:8081/api/v2/cteos/exporta?grupo=meugrupo&cnpj=29062609000177" \
  -H "Content-Type: application/json" \
  -H "Authorization: Basic YWRtaW46MTIzbXVkYXI=" \
  -d '{"dataInicial": "2024-01-01", "dataFinal": "2024-01-31", "pdf": true}'

# 2. Consultar protocolo
curl -X GET "https://managersaas.tecnospeed.com.br:8081/api/v2/cteos/exporta/f1b740ba-6899-4d80-83e8-43dacfb04351?grupo=meugrupo&cnpj=29062609000177" \
  -H "Authorization: Basic YWRtaW46MTIzbXVkYXI="

# 3. Baixar XMLs
curl -X GET "https://managersaas.tecnospeed.com.br:8081/api/v2/cteos/exporta/f1b740ba-6899-4d80-83e8-43dacfb04351/xml?grupo=meugrupo&cnpj=29062609000177" \
  -H "Authorization: Basic YWRtaW46MTIzbXVkYXI=" \
  -o xmls.zip

# 4. Baixar PDFs
curl -X GET "https://managersaas.tecnospeed.com.br:8081/api/v2/cteos/exporta/f1b740ba-6899-4d80-83e8-43dacfb04351/pdf?grupo=meugrupo&cnpj=29062609000177" \
  -H "Authorization: Basic YWRtaW46MTIzbXVkYXI=" \
  -o pdfs.zip
```

### Exemplo 2: Exportação com Filtros de Numeração

```bash
curl -X POST "https://managersaas.tecnospeed.com.br:8081/api/v2/cteos/exporta?grupo=meugrupo&cnpj=29062609000177" \
  -H "Content-Type: application/json" \
  -H "Authorization: Basic YWRtaW46MTIzbXVkYXI=" \
  -d '{"dataInicial": "2024-01-01", "dataFinal": "2024-01-31", "pdf": true, "serie": "1", "numeroInicial": "1", "numeroFinal": "100"}'
```

## Limitações e Considerações

1. **Período máximo**: 31 dias entre dataInicial e dataFinal
2. **Timeout**: 40 minutos para processamento
3. **Disponibilidade**: Arquivos disponíveis por 15 dias
4. **Tamanho**: Arquivos grandes podem demorar para processar
5. **Concorrência**: Evite múltiplas solicitações simultâneas

## Tratamento de Erros

### Erros Comuns

- **"Timeout de 40m0s excedido"** - Solicitar nova exportação
- **"Período máximo de 31 dias"** - Reduzir o período de consulta
- **"Nenhum registro encontrado"** - Verificar filtros e período
- **"Erro ao obter dados"** - Tentar novamente mais tarde

### Boas Práticas

1. **Sempre guardar o protocolo** retornado na primeira requisição
2. **Consultar o protocolo** antes de tentar baixar os arquivos
3. **Usar períodos menores** para evitar timeouts
4. **Implementar retry** em caso de falhas
5. **Monitorar o status** do processamento